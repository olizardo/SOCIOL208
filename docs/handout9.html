<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SOCIOL 208 - Statistical Models of Networks I</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="SOCIOL 208 - Statistical Models of Networks I">
<meta property="og:description" content="So far we have treated the observed ties in a given network as given, along with any metrics computed from those ties (e.g., attribute correlations, centralities, etc.).">
<meta property="og:site-name" content="SOCIOL 208">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Statistical Models of Networks I</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SOCIOL 208</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">208A</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-208A.html" class="sidebar-item-text sidebar-link">208A Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule-208A-F24.html" class="sidebar-item-text sidebar-link">SOCIOL 208A Reading Schedule (Fall 2024)</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Handouts</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout1.html" class="sidebar-item-text sidebar-link">Basic Network Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inoutdegdist.html" class="sidebar-item-text sidebar-link">Graph Degree Metrics in Directed Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout2.html" class="sidebar-item-text sidebar-link">Centrality</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cube.html" class="sidebar-item-text sidebar-link">The Cube</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout3.html" class="sidebar-item-text sidebar-link">Status and Prestige</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout4.html" class="sidebar-item-text sidebar-link">Role Equivalence and Structural Similarity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout5.html" class="sidebar-item-text sidebar-link">Vertex Similarity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./blondel.html" class="sidebar-item-text sidebar-link">Role Similarity Across Graphs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout6.html" class="sidebar-item-text sidebar-link">Community Structure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ahn.html" class="sidebar-item-text sidebar-link">Assigning Nodes to Multiple Communities</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout7.html" class="sidebar-item-text sidebar-link">Analyzing Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ca.html" class="sidebar-item-text sidebar-link">Correspondence Analysis (CA) of Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spectral.html" class="sidebar-item-text sidebar-link">Community Detection Using Spectral Clustering</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout8.html" class="sidebar-item-text sidebar-link">Analyzing Ego Networks</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">208B</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-208B.html" class="sidebar-item-text sidebar-link">208B Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule-208B-S24.html" class="sidebar-item-text sidebar-link">SOCIOL 208B Reading Schedule (Spring 2024)</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#random-networks" id="toc-random-networks" class="nav-link active" data-scroll-target="#random-networks">Random Networks</a></li>
  <li><a href="#graph-ensembles" id="toc-graph-ensembles" class="nav-link" data-scroll-target="#graph-ensembles">Graph Ensembles</a></li>
  <li><a href="#the-erdos-renyi-model" id="toc-the-erdos-renyi-model" class="nav-link" data-scroll-target="#the-erdos-renyi-model">The Erdos-Renyi Model</a></li>
  <li><a href="#null-hypothesis-testing" id="toc-null-hypothesis-testing" class="nav-link" data-scroll-target="#null-hypothesis-testing">Null Hypothesis Testing</a></li>
  <li><a href="#preserving-degrees" id="toc-preserving-degrees" class="nav-link" data-scroll-target="#preserving-degrees">Preserving Degrees</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/olizardo/SOCIOL208/blob/main/handout9.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Statistical Models of Networks I</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>So far we have treated the observed ties in a given network as given, along with any metrics computed from those ties (e.g., attribute correlations, centralities, etc.). The idea of uncertainty around an estimate, foundational to traditional statistics, has so far not been applicable.</p>
<p>Another approach, and one that brings in concerns about inference, statistical significance, and so forth, is to think of the observed network data as a <em>realization</em> of some underlying random or probabilistic process.</p>
<section id="random-networks" class="level2">
<h2 class="anchored" data-anchor-id="random-networks">Random Networks</h2>
<p>There are many ways to go about this, but here we will cover two important ones. First we can treat the <em>whole network</em> as a realization of some random process. That leads to models of <strong>random networks</strong> and <strong>graph ensembles</strong> <span class="citation" data-cites="orsini_etal15">(<a href="#ref-orsini_etal15" role="doc-biblioref">Orsini et al. 2015</a>)</span> that are useful for testing single hypotheses (e.g., are the levels of homophily that I am observing in this network more or less than we would expect by chance?).</p>
<p>Second, there are models that treat each <em>link</em> in the network as a realization of some random process <span class="citation" data-cites="pattison_robins12">(<a href="#ref-pattison_robins12" role="doc-biblioref">Pattison and Robins 2002</a>)</span>. Because a network is just a set of links these models are also treating the network as random, but allow us to test more fine-grained multivariate hypothesis by conditioning on characteristics of the ties and the nodes that are involved in each link. This is the family of <strong>exponential random graph models</strong> for networks usually abbreviated as ERGMs and pronounced “ergums.”</p>
<p>In this handout we will discuss the first of these strategies.</p>
</section>
<section id="graph-ensembles" class="level2">
<h2 class="anchored" data-anchor-id="graph-ensembles">Graph Ensembles</h2>
<p>A <strong>graph ensemble</strong> is just a set of graphs that share some graph level property (like the ones we studied in the very first handout). For instance, they might have the same number of nodes, or the same number of edges, or both, but are different in terms of which particular nodes connect to which.</p>
<p>Note that if an ensemble of graphs has the same number of nodes and edges, they will also be identical with regard to any property that is a function of these two things, like the <strong>density</strong>.</p>
<p>Usually, what we would want is a graph ensemble that <em>matches</em> the properties that we observe in a graph that corresponds to the network of interest. The idea is to create an ensemble of graphs that are similar to our original data. We can then use the ensemble to test whether some quantity we observe in our data is larger or smaller than we would expect by chance. Here “chance” is simply the <em>probability</em> of observing that value in the ensemble of graphs we created.</p>
<p>As <span class="citation" data-cites="orsini_etal15">Orsini et al. (<a href="#ref-orsini_etal15" role="doc-biblioref">2015</a>)</span> note, a simple way to create an ensemble is just by using an <strong>edge swapping algorithm</strong> on the original graph. Each edge swapping algorithm works by <em>preserving</em> some property of the original graph across each realization, so that all the graphs in the ensemble share that property.</p>
</section>
<section id="the-erdos-renyi-model" class="level2">
<h2 class="anchored" data-anchor-id="the-erdos-renyi-model">The Erdos-Renyi Model</h2>
<p>In the simplest case, we create an ensemble that preserves the number of nodes and edges of the original graph (and everything that is a function of these, like density and average degree) and randomizes everything else in the ensemble relative to the observed graph.</p>
<p>Let’s see how this would work. First we load up a network, in this case Krackardt’s high tech managers data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>   <span class="fu">library</span>(networkdata)</span>
<span id="cb1-2"><a href="#cb1-2"></a>   <span class="fu">library</span>(igraph)</span>
<span id="cb1-3"><a href="#cb1-3"></a>   g <span class="ot">&lt;-</span> ht_friends</span>
<span id="cb1-4"><a href="#cb1-4"></a>   g <span class="ot">&lt;-</span> <span class="fu">as_undirected</span>(g, <span class="at">mode =</span> <span class="st">"collapse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is the undirected version of the friendship nominations network. Let’s review some graph properties:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>   <span class="fu">vcount</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>   <span class="fu">ecount</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 79</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>   <span class="fu">edge_density</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3761905</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>   <span class="fu">mean</span>(<span class="fu">degree</span>(g))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.52381</code></pre>
</div>
</div>
<p>We can see that we have <span class="math inline">\(|V| = 21\)</span>, <span class="math inline">\(|E|=79\)</span>, <span class="math inline">\(d=0.38\)</span>, and <span class="math inline">\(\bar{k}=7.5\)</span>.</p>
<p>We can do a simply <strong>rewiring</strong> of this graph, by using the following algorithm: Pick a random edge, detach it from the vertices that are incident to it, and attach it to a new pair of vertices that are current disconnected. Do that for some proportion of the edges in the graph.</p>
<p>The result is a new “rewired” graph, that still has the same number of nodes and edges as the original (hence same density and average degree), but with whatever original tie-formation tendencies in the original graph scrambled up.</p>
<p>In <code>igraph</code> we can use the <code>rewire</code> function, along with the <code>each_edge</code> rewiring algorithm to accomplish this. Let’s say we wanted to rewire up to 50% of the edges of the original network. We would then type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>   <span class="fu">set.seed</span> (<span class="dv">123</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>   g.swap1 <span class="ot">&lt;-</span> <span class="fu">rewire</span>(g, <span class="fu">each_edge</span>(<span class="at">prob =</span> .<span class="dv">5</span>, <span class="at">loops =</span> <span class="cn">FALSE</span>, <span class="at">multiple =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Which creates a new graph called <code>g.swap1</code> with 50% of the edges scrambled (note that we set the seed if we want to get the same graph every time we run it).</p>
<p>As we can see the new graph preserves the density and average degree of the original:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>   <span class="fu">vcount</span>(g.swap1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>   <span class="fu">ecount</span>(g.swap1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 79</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>   <span class="fu">edge_density</span>(g.swap1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3761905</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>   <span class="fu">mean</span>(<span class="fu">degree</span>(g.swap1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.52381</code></pre>
</div>
</div>
<p>And here’s a side-by-side comparison:</p>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout9_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Original Friendship Network.</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout9_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">One Density Preserving Swap.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p>Note that while we preferred <em>some</em> structural features of the original network, the swapped graph has a very different structure!</p>
<p>Here are two other graphs that also have the same average degree and density as the original but with 100% of the edges rewired:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>   <span class="fu">set.seed</span> (<span class="dv">456</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a>   g.swap2 <span class="ot">&lt;-</span> <span class="fu">rewire</span>(g, <span class="fu">each_edge</span>(<span class="at">prob =</span> <span class="dv">1</span>, <span class="at">loops =</span> <span class="cn">FALSE</span>, <span class="at">multiple =</span> <span class="cn">FALSE</span>))</span>
<span id="cb19-3"><a href="#cb19-3"></a>   <span class="fu">set.seed</span> (<span class="dv">789</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a>   g.swap3 <span class="ot">&lt;-</span> <span class="fu">rewire</span>(g, <span class="fu">each_edge</span>(<span class="at">prob =</span> <span class="dv">1</span>, <span class="at">loops =</span> <span class="cn">FALSE</span>, <span class="at">multiple =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout9_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Another Density Preserving Swap.</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout9_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Yet Another Density Preserving Swap.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p>One of the reasons why these graphs looks so different from the original is that while these graphs all have the same <strong>average degree</strong>, the specific degrees of each node are <em>not</em> preserved. This is clear if you compare node 13 in the original graph (which is poorly-connected, with only two friends) to node 13 in the graph to the right of the original, where they now have many (random) friends.</p>
<p>Note that other non-local graph properties (which don’t depend directly on the number of nodes and edges) are also not preserved. For instance, the <strong>graph diameter</strong> is different across swaps:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>   <span class="fu">mean</span>(<span class="fu">distances</span>(g))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.569161</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>   <span class="fu">mean</span>(<span class="fu">distances</span>(g.swap1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.560091</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>   <span class="fu">mean</span>(<span class="fu">distances</span>(g.swap2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.609977</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>   <span class="fu">mean</span>(<span class="fu">distances</span>(g.swap3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.573696</code></pre>
</div>
</div>
<p>We will learn how to create graph ensembles that preserve specific node degrees in a bit. But first, let’s see what we can do with graph ensembles.</p>
</section>
<section id="null-hypothesis-testing" class="level2">
<h2 class="anchored" data-anchor-id="null-hypothesis-testing">Null Hypothesis Testing</h2>
<p>Remember that one thing we wanted to do is <strong>null hypothesis testing</strong>; that is, we want to see if something computed in the original graph is more or less than we would expect by chance, given a suitable “null model”, which in our case is a network where the density—and thus expected degree—is preserved but people connect at random (sometimes called an <strong>Erdos-Renyi</strong> model).</p>
<p>So let’s compute something:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>   <span class="fu">assortativity</span>(g, <span class="fu">V</span>(g)<span class="sc">$</span>level)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1116466</code></pre>
</div>
</div>
<p>This is Newman’s <strong>assortativity coefficient</strong> (a.k.a., the modularity) for the nominal category of “Level” telling us that ties are more likely to form between managers of the same level in the company. Is this a “statistically significant” level of assortativity?</p>
<p>Well compared to what? Compared to what we observe in an ensemble of graphs with the same number of nodes, edges, and density!</p>
<p>How do we do that comparison?</p>
<p>First, let’s wrap the density-preserving rewiring into a function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>   swap1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">p =</span> <span class="dv">1</span>) {</span>
<span id="cb30-2"><a href="#cb30-2"></a>      x <span class="ot">&lt;-</span> <span class="fu">rewire</span>(x, <span class="fu">each_edge</span>(<span class="at">prob =</span> p, <span class="at">loops =</span> <span class="cn">FALSE</span>, <span class="at">multiple =</span> <span class="cn">FALSE</span>))</span>
<span id="cb30-3"><a href="#cb30-3"></a>      <span class="fu">return</span>(x)</span>
<span id="cb30-4"><a href="#cb30-4"></a>   }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s create an ensemble of 500 edge-swapped graphs, putting them all into a list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>   G <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb31-2"><a href="#cb31-2"></a>   <span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>) {</span>
<span id="cb31-4"><a href="#cb31-4"></a>      G[[i]] <span class="ot">&lt;-</span> <span class="fu">swap1</span>(g)</span>
<span id="cb31-5"><a href="#cb31-5"></a>   }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we compute our assortativity coefficient in each one of them using <code>sapply</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>   assort <span class="ot">&lt;-</span> <span class="fu">sapply</span>(G, assortativity, <span class="at">values =</span> <span class="fu">V</span>(g)<span class="sc">$</span>level)</span>
<span id="cb32-2"><a href="#cb32-2"></a>   <span class="fu">round</span>(assort, <span class="dv">2</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] -0.08 -0.02 -0.07 -0.08 -0.14 -0.11  0.01  0.04 -0.05  0.33 -0.09  0.00
 [13] -0.07  0.11 -0.04  0.16 -0.14  0.04 -0.10 -0.04  0.03 -0.13 -0.01 -0.04
 [25] -0.20  0.00 -0.10  0.00  0.03 -0.03 -0.05 -0.01 -0.11 -0.02  0.02 -0.06
 [37] -0.15 -0.07 -0.21 -0.15 -0.08 -0.21 -0.18 -0.04 -0.02 -0.17 -0.19 -0.06
 [49]  0.04 -0.12 -0.11 -0.02 -0.05 -0.15 -0.01 -0.04 -0.11  0.03  0.04  0.09
 [61] -0.10 -0.10 -0.10  0.09 -0.09  0.01 -0.12  0.04 -0.13 -0.05 -0.04 -0.08
 [73] -0.07 -0.21 -0.09 -0.13  0.08 -0.10 -0.07 -0.02 -0.22 -0.08 -0.06 -0.13
 [85] -0.12 -0.10 -0.12  0.03 -0.12 -0.13 -0.10 -0.11 -0.05 -0.07 -0.04 -0.16
 [97] -0.07 -0.04  0.04 -0.04</code></pre>
</div>
</div>
<p>Note that the modularity is actually negative in most of these graphs, suggesting that when people form ties at random they are unlikely to magically end up being assortative by department.</p>
<p>So let’s see how our observed value stacks up in the grand scheme:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>   <span class="fu">library</span>(ggplot2)</span>
<span id="cb34-2"><a href="#cb34-2"></a>   p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="fu">round</span>(assort, <span class="dv">2</span>)), <span class="fu">aes</span>(<span class="at">x =</span> assort))</span>
<span id="cb34-3"><a href="#cb34-3"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.005</span>, <span class="at">stat =</span> <span class="st">"bin"</span>, <span class="at">fill =</span> <span class="st">"darkblue"</span>)</span>
<span id="cb34-4"><a href="#cb34-4"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">assortativity</span>(g, <span class="fu">V</span>(g)<span class="sc">$</span>level), </span>
<span id="cb34-5"><a href="#cb34-5"></a>                       <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb34-6"><a href="#cb34-6"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">1</span>, </span>
<span id="cb34-7"><a href="#cb34-7"></a>                       <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb34-8"><a href="#cb34-8"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Q by Level"</span>, <span class="at">y =</span> <span class="st">"Freq."</span>)</span>
<span id="cb34-9"><a href="#cb34-9"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb34-10"><a href="#cb34-10"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="sc">-</span><span class="fl">0.05</span>, <span class="at">y=</span><span class="dv">22</span>, <span class="at">label=</span> <span class="st">"Zero Point"</span>, <span class="at">color =</span> <span class="st">"purple"</span>)</span>
<span id="cb34-11"><a href="#cb34-11"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">0.06</span>, <span class="at">y=</span><span class="dv">22</span>, <span class="at">label=</span> <span class="st">"Obs. Value"</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb34-12"><a href="#cb34-12"></a>   p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="handout9_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So we can see that only a few of the networks in the ensemble have <span class="math inline">\(Q\)</span> values higher than the observed one, indicating that what we observed is unlikely to have occurred by chance.</p>
<p>How unlikely? We can just compute the value that corresponds to the 99th percentile of the assortativity distribution from the ensemble and then see if what observe is above that value (corresponding to <span class="math inline">\(p &lt; 0.01\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>   <span class="fu">quantile</span>(assort, <span class="at">probs =</span> <span class="fl">0.99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      99% 
0.1533994 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>   <span class="fu">assortativity</span>(g, <span class="fu">V</span>(g)<span class="sc">$</span>level) <span class="sc">&gt;</span> <span class="fu">quantile</span>(assort, <span class="at">probs =</span> <span class="fl">0.99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  99% 
FALSE </code></pre>
</div>
</div>
<p>We find that our observed value of assortativity by dept is not significant at this level, as the corresponding value in the ensemble distribution is higher than what we observe.</p>
<p>Of course we can also try a less stringent standard for statistical significance, like <span class="math inline">\(p &lt; 0.05\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>   <span class="fu">quantile</span>(assort, <span class="at">probs =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      95% 
0.0665133 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>   <span class="fu">assortativity</span>(g, <span class="fu">V</span>(g)<span class="sc">$</span>level) <span class="sc">&gt;</span> <span class="fu">quantile</span>(assort, <span class="at">probs =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 95% 
TRUE </code></pre>
</div>
</div>
<p>Which, in this case, is “statistically significant”! This is because the observed value is larger than the corresponding value at the 95th percentile slot of the graph ensemble distribution.</p>
<p>If we wanted to find the actual “p-value” corresponding to our observed value, we would just type the following, which uses the native <code>R</code> function <code>ecdf</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>   <span class="dv">1</span> <span class="sc">-</span> <span class="fu">ecdf</span>(assort)(<span class="fu">assortativity</span>(g, <span class="fu">V</span>(g)<span class="sc">$</span>level))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.014</code></pre>
</div>
</div>
<p>Which yields <span class="math inline">\(p = 0.014\)</span> for our observed value of assortativity by department, which is good enough to get published.</p>
</section>
<section id="preserving-degrees" class="level2">
<h2 class="anchored" data-anchor-id="preserving-degrees">Preserving Degrees</h2>
<p>Recall that our swapping function above preserves the <em>expected</em> (average) degree but not the degree of any particular node. This means that the neither the <strong>degree sequence</strong> nor the <strong>degree distribution</strong> of the original network is preserved.</p>
<p>This is clear in the following plots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>   <span class="fu">library</span>(dplyr)</span>
<span id="cb45-2"><a href="#cb45-2"></a>   <span class="fu">library</span>(tidyr)</span>
<span id="cb45-3"><a href="#cb45-3"></a>   deg.dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Original =</span> <span class="fu">degree</span>(g), <span class="at">Swap1 =</span> <span class="fu">degree</span>(g.swap1), <span class="at">Swap2 =</span> <span class="fu">degree</span>(g.swap2), <span class="at">Swap3 =</span> <span class="fu">degree</span>(g.swap3)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="#cb45-4"></a>   <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">names_to =</span> <span class="st">"graph"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="#cb45-5"></a>      <span class="fu">mutate</span>(<span class="at">v =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">vcount</span>(g), <span class="dv">4</span>)))</span>
<span id="cb45-6"><a href="#cb45-6"></a>   p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> deg.dat, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">group =</span> graph, <span class="at">fill =</span> graph))</span>
<span id="cb45-7"><a href="#cb45-7"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.35</span>)</span>
<span id="cb45-8"><a href="#cb45-8"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> graph, <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb45-9"><a href="#cb45-9"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb45-10"><a href="#cb45-10"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb45-11"><a href="#cb45-11"></a>                  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb45-12"><a href="#cb45-12"></a>                  <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb45-13"><a href="#cb45-13"></a>                  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) </span>
<span id="cb45-14"><a href="#cb45-14"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>))</span>
<span id="cb45-15"><a href="#cb45-15"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span><span class="st">""</span>)</span>
<span id="cb45-16"><a href="#cb45-16"></a>   p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="handout9_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The top shows the original degree distribution, which is different from the ones in the swapped graphs. In fact, it is clear that the swapped degree distribution get rid of extreme high degree nodes and pull everyone to the middle (Erdos-Renyi graphs degrees tend toward a Poisson distribution).</p>
<p>So it could be that the plain <strong>average degree</strong> (Erdos-Renyi) preserving model is too simplistic to use as a plausible null model. A better model is one that would preserve the degrees of each node in the ensemble but make every connection otherwise random.</p>
<p>In <code>igraph</code> there is a trusty function called <code>keeping_degseq</code>—which is used alongside the more general function <code>rewire</code> we used earlier—that allows us to scramble the edges in a graph while keeping the degrees of each node the same as the original.</p>
<p>The basic idea is to sample a pair of edges connecting vertices <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span> and <span class="math inline">\(d\)</span> respectively, delete them, and create two new edges (if they don’t currently exist) between vertices <span class="math inline">\(a\)</span> and <span class="math inline">\(c\)</span> and between <span class="math inline">\(b\)</span> and <span class="math inline">\(d\)</span>, repeating this process <code>m</code> number of times. As it is clear, this randomizes connections but keeps the number of edges incident to each node the same <span class="citation" data-cites="maslov_sneppen02">(<a href="#ref-maslov_sneppen02" role="doc-biblioref">Maslov and Sneppen 2002</a>)</span>.</p>
<p>Let’s see how it works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>   g.swap <span class="ot">&lt;-</span> <span class="fu">rewire</span>(g, <span class="fu">keeping_degseq</span>(<span class="at">niter =</span> <span class="dv">50</span>))</span>
<span id="cb46-2"><a href="#cb46-2"></a>   <span class="fu">degree</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  9 10  6  7 10  7  3  5  6  8 14  8  2  6  9  5 18  4 10  5  6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>   <span class="fu">degree</span>(g.swap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  9 10  6  7 10  7  3  5  6  8 14  8  2  6  9  5 18  4 10  5  6</code></pre>
</div>
</div>
<p>Which we can see creates a new graph with exactly the same degree sequence as the original. Here they are side-by-side:</p>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout9_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Original Friendship Network.</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout9_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">One Degree Preserving Swap.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p>As we can see, the network structure is definitely different between these two graphs, but each node has the same levels of connectivity in each.</p>
<p>So now we can use our more stringent null model to test our previous hypothesis: Is the observed level of assortativity by level more than we would observe in the same network where everyone keeps their degree centrality but everything is random?</p>
<p>Let’s find out.</p>
<p>First, let’s wrap the degree-preserving swap into a function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>   swap2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">m =</span> <span class="dv">50</span>) {</span>
<span id="cb50-2"><a href="#cb50-2"></a>      x <span class="ot">&lt;-</span> <span class="fu">rewire</span>(x, <span class="fu">keeping_degseq</span>(<span class="at">niter =</span> m))</span>
<span id="cb50-3"><a href="#cb50-3"></a>      <span class="fu">return</span>(x)</span>
<span id="cb50-4"><a href="#cb50-4"></a>   }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then let’s create our graph ensemble this time using 500 graphs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>   G2 <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb51-2"><a href="#cb51-2"></a>   <span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb51-3"><a href="#cb51-3"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>) {</span>
<span id="cb51-4"><a href="#cb51-4"></a>      G2[[i]] <span class="ot">&lt;-</span> <span class="fu">swap2</span>(g)</span>
<span id="cb51-5"><a href="#cb51-5"></a>   }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And see where our observed value falls in the distribution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>   assort <span class="ot">&lt;-</span> <span class="fu">sapply</span>(G2, assortativity, <span class="at">values =</span> <span class="fu">V</span>(g)<span class="sc">$</span>level)</span>
<span id="cb52-2"><a href="#cb52-2"></a>   <span class="fu">library</span>(ggplot2)</span>
<span id="cb52-3"><a href="#cb52-3"></a>   p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="fu">round</span>(assort, <span class="dv">2</span>)), <span class="fu">aes</span>(<span class="at">x =</span> assort))</span>
<span id="cb52-4"><a href="#cb52-4"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.015</span>, <span class="at">stat =</span> <span class="st">"bin"</span>, <span class="at">fill =</span> <span class="st">"darkblue"</span>)</span>
<span id="cb52-5"><a href="#cb52-5"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">assortativity</span>(g, <span class="fu">V</span>(g)<span class="sc">$</span>level), </span>
<span id="cb52-6"><a href="#cb52-6"></a>                       <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb52-7"><a href="#cb52-7"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">1</span>, </span>
<span id="cb52-8"><a href="#cb52-8"></a>                       <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb52-9"><a href="#cb52-9"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Q by Level"</span>, <span class="at">y =</span> <span class="st">"Freq."</span>)</span>
<span id="cb52-10"><a href="#cb52-10"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb52-11"><a href="#cb52-11"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="sc">-</span><span class="fl">0.04</span>, <span class="at">y=</span><span class="dv">170</span>, <span class="at">label=</span> <span class="st">"Zero Point"</span>, <span class="at">color =</span> <span class="st">"purple"</span>)</span>
<span id="cb52-12"><a href="#cb52-12"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">0.07</span>, <span class="at">y=</span><span class="dv">170</span>, <span class="at">label=</span> <span class="st">"Obs. Value"</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb52-13"><a href="#cb52-13"></a>   p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="handout9_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that the values are much more constrained this time around, falling within specific ranges. We can test our hypothesis the same way as before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>   <span class="fu">quantile</span>(assort, <span class="at">probs =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      95% 
0.1751004 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>   <span class="fu">assortativity</span>(g, <span class="fu">V</span>(g)<span class="sc">$</span>level) <span class="sc">&gt;</span> <span class="fu">quantile</span>(assort, <span class="at">probs =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  95% 
FALSE </code></pre>
</div>
</div>
<p>Which tells us that after account for node degree differences, the observed value we observed is not significant using conventional cutoffs.</p>
<p>Instead, the p-value of the estimate is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>   <span class="dv">1</span> <span class="sc">-</span> <span class="fu">ecdf</span>(assort)(<span class="fu">assortativity</span>(g, <span class="fu">V</span>(g)<span class="sc">$</span>level))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.064</code></pre>
</div>
</div>
<p>Which is close, but not quite at the level of usual conventional standards for statistical significance. Looks like our paper will be rejected after all!</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-maslov_sneppen02" class="csl-entry" role="doc-biblioentry">
Maslov, Sergei, and Kim Sneppen. 2002. <span>“Specificity and Stability in Topology of Protein Networks.”</span> <em>Science</em> 296 (5569): 910–13.
</div>
<div id="ref-orsini_etal15" class="csl-entry" role="doc-biblioentry">
Orsini, Chiara, Marija M Dankulov, Pol Colomer-de-Simón, Almerima Jamakovic, Priya Mahadevan, Amin Vahdat, Kevin E Bassler, et al. 2015. <span>“Quantifying Randomness in Real Networks.”</span> <em>Nature Communications</em> 6 (1): 8627.
</div>
<div id="ref-pattison_robins12" class="csl-entry" role="doc-biblioentry">
Pattison, Philippa, and Garry Robins. 2002. <span>“Neighborhood-Based Models for Social Networks.”</span> <em>Sociological Methodology</em> 32 (1): 301–37.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>