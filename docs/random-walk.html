<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SOCIOL 208 - Random Walk Concepts in Networks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="SOCIOL 208 - Random Walk Concepts in Networks">
<meta property="og:description" content="Imagine something is diffusing through a network starting with some seed node \(i\) following a series of discrete time steps.">
<meta property="og:site-name" content="SOCIOL 208">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Random Walk Concepts in Networks</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SOCIOL 208</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">208A</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-208A.html" class="sidebar-item-text sidebar-link">208A Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule-208A-F24.html" class="sidebar-item-text sidebar-link">SOCIOL 208A Reading Schedule (Fall 2024)</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Lecture Notes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basic.html" class="sidebar-item-text sidebar-link">Basic Network Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ego.html" class="sidebar-item-text sidebar-link">Analyzing Ego Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eigen.html" class="sidebar-item-text sidebar-link">The Eigendecomposition of a Square Matrix</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Centrality and Prestige</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./centrality.html" class="sidebar-item-text sidebar-link">Centrality</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cube.html" class="sidebar-item-text sidebar-link">The Centrality Cube</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prestige.html" class="sidebar-item-text sidebar-link">Status and Prestige</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Equivalence and Similarity</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth3 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structequiv.html" class="sidebar-item-text sidebar-link">Role Equivalence and Structural Similarity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./similarity.html" class="sidebar-item-text sidebar-link">Vertex Similarity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./random-walk.html" class="sidebar-item-text sidebar-link active">Random Walk Concepts in Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./blondel.html" class="sidebar-item-text sidebar-link">Role Similarity Across Graphs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ahn.html" class="sidebar-item-text sidebar-link">Assigning Nodes to Multiple Communities</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">Communities and Clustering</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./community.html" class="sidebar-item-text sidebar-link">Community Structure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spectral.html" class="sidebar-item-text sidebar-link">Community Detection Using Spectral Clustering</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">Two-Mode Networks</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tm-basic.html" class="sidebar-item-text sidebar-link">Analyzing Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tm-centrality.html" class="sidebar-item-text sidebar-link">Centrality in Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tm-duality.html" class="sidebar-item-text sidebar-link">The Duality of Persons and Groups</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tm-similarity.html" class="sidebar-item-text sidebar-link">Similarity and Equivalence in Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tm-ca.html" class="sidebar-item-text sidebar-link">Correspondence Analysis (CA) of Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tm-null.html" class="sidebar-item-text sidebar-link">Graph Ensembles in Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./backbone.html" class="sidebar-item-text sidebar-link">Extracting the Backbone of Bipartite Projections Using Two-Mode Graph Ensembles</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">Statistical Models</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./swap.html" class="sidebar-item-text sidebar-link">Graph Ensembles in Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qap.html" class="sidebar-item-text sidebar-link">Network Regression Using Permutation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ergm1.html" class="sidebar-item-text sidebar-link">Exponential Random Graphs Models I</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ergm2.html" class="sidebar-item-text sidebar-link">Exponential Random Graphs Models II</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">Data Management</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loading.html" class="sidebar-item-text sidebar-link">Loading Network Data from a File</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./network-lists.html" class="sidebar-item-text sidebar-link">Handling Graph Objects in Lists</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./subgraph-select.html" class="sidebar-item-text sidebar-link">Selecting a Subgraph Based on Edge Conditions</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">208B</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-208B.html" class="sidebar-item-text sidebar-link">208B Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule-208B-S24.html" class="sidebar-item-text sidebar-link">SOCIOL 208B Reading Schedule (Spring 2024)</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-average-first-passage-time" id="toc-the-average-first-passage-time" class="nav-link active" data-scroll-target="#the-average-first-passage-time">The Average First Passage Time</a></li>
  <li><a href="#averaging-across-realizations" id="toc-averaging-across-realizations" class="nav-link" data-scroll-target="#averaging-across-realizations">Averaging Across Realizations</a></li>
  <li><a href="#iterating-until-convergence" id="toc-iterating-until-convergence" class="nav-link" data-scroll-target="#iterating-until-convergence">Iterating Until Convergence</a></li>
  <li><a href="#using-the-laplacian-matrix" id="toc-using-the-laplacian-matrix" class="nav-link" data-scroll-target="#using-the-laplacian-matrix">Using the Laplacian Matrix</a></li>
  <li><a href="#the-average-commute-distance" id="toc-the-average-commute-distance" class="nav-link" data-scroll-target="#the-average-commute-distance">The Average Commute Distance</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/olizardo/SOCIOL208/blob/main/random-walk.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Random Walk Concepts in Networks</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="the-average-first-passage-time" class="level2">
<h2 class="anchored" data-anchor-id="the-average-first-passage-time">The Average First Passage Time</h2>
<p>Imagine something is diffusing through a network starting with some seed node <span class="math inline">\(i\)</span> following a series of discrete time steps. If the graph is connected, the thing will eventually reach every node in the network. However, depending on the connectivity structure of the graph, it will reach some nodes (e.g., those at a smaller graph theoretic distance from the seed node) sooner than others.</p>
<p>Here’s a function called <code>first.pass1</code> that records the minimum number of steps that it takes for something to get to each node in a graph starting from a given seed node:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>   first.pass1 <span class="ot">&lt;-</span> <span class="cf">function</span>(w, <span class="at">seed =</span> <span class="dv">1</span>) {</span>
<span id="cb1-2"><a href="#cb1-2"></a>      fp <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(w))</span>
<span id="cb1-3"><a href="#cb1-3"></a>      k <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>      i <span class="ot">&lt;-</span> seed</span>
<span id="cb1-5"><a href="#cb1-5"></a>      <span class="cf">while</span>(<span class="fu">sum</span>(fp[<span class="sc">-</span>seed] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb1-6"><a href="#cb1-6"></a>         j <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(w)), <span class="dv">1</span>, <span class="at">prob =</span> w[i, ]) </span>
<span id="cb1-7"><a href="#cb1-7"></a>         <span class="cf">if</span> (fp[j] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> j <span class="sc">!=</span> seed) {fp[j] <span class="ot">&lt;-</span> k}</span>
<span id="cb1-8"><a href="#cb1-8"></a>         i <span class="ot">&lt;-</span> j</span>
<span id="cb1-9"><a href="#cb1-9"></a>         k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>         }</span>
<span id="cb1-11"><a href="#cb1-11"></a>   <span class="fu">names</span>(fp) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(w)</span>
<span id="cb1-12"><a href="#cb1-12"></a>   <span class="fu">return</span>(fp)</span>
<span id="cb1-13"><a href="#cb1-13"></a>   }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function takes a transition matrix <span class="math inline">\(\mathbf{P}\)</span> as the primary input (of the sort we discussed when talking about <a href="#prestige.qmd">status and prestige</a>) and returns a vector containing the time step at which the thing that diffused through the network got to the <span class="math inline">\(j^{th}\)</span> node.</p>
<p>Let’s test it out using the friendship network from the Krackhardt high-tech managers data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>   <span class="fu">library</span>(networkdata)</span>
<span id="cb2-2"><a href="#cb2-2"></a>   <span class="fu">library</span>(igraph)</span>
<span id="cb2-3"><a href="#cb2-3"></a>   g <span class="ot">&lt;-</span> <span class="fu">as_undirected</span>(ht_friends, <span class="at">mode =</span> <span class="st">"collapse"</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>   A <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">as_adjacency_matrix</span>(g))</span>
<span id="cb2-5"><a href="#cb2-5"></a>   P <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">rowSums</span>(A)) <span class="sc">%*%</span> A    </span>
<span id="cb2-6"><a href="#cb2-6"></a>   <span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>   <span class="fu">first.pass1</span>(P)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 
  0   2 137  24  14  28  43  36   8   9  16  29  15  26   7   1  25  33   6  32 
 21 
 12 </code></pre>
</div>
</div>
<p>We can see for instance that the rumor got to node 16 in just one time step, but that it took 24 time steps to get to node 3 and 137 (!) to get to node 3.</p>
<p>So it seems like this, the minimum time it takes for something that starts with me to get to you <span class="citation" data-cites="fouss_etal04b">(<a href="#ref-fouss_etal04b" role="doc-biblioref">Fouss, Pirotte, and Saerens 2004</a>)</span>, is a good measure of the proximity between me and you in the graph.</p>
</section>
<section id="averaging-across-realizations" class="level2">
<h2 class="anchored" data-anchor-id="averaging-across-realizations">Averaging Across Realizations</h2>
<p>However, we wouldn’t want to use just one run of the diffusion process to calculate this proximity measure. Instead a better approach is to use the <em>average time</em> it takes for something to get to the other nodes when it starts from a given node.</p>
<p>To do that, we can just <code>replicate</code> the <code>first.pass1</code> function some number of times (e.g., <span class="math inline">\(n = 100\)</span>) and take an average:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>   <span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a>   first.res <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">100</span>, <span class="fu">first.pass1</span>(P))</span>
<span id="cb4-3"><a href="#cb4-3"></a>   <span class="fu">round</span>(<span class="fu">rowMeans</span>(first.res), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    1     2     3     4     5     6     7     8     9    10    11    12    13 
 0.00 16.14 32.88 21.24 17.17 24.35 59.98 27.83 25.85 17.75 10.16 15.78 86.78 
   14    15    16    17    18    19    20    21 
36.32 15.43 32.94  8.65 44.59 19.17 31.47 33.85 </code></pre>
</div>
</div>
<p>We can see that according to this measure, called <strong>the average first passage time</strong> <span class="citation" data-cites="fouss_etal16">(<a href="#ref-fouss_etal16" role="doc-biblioref">Fouss, Saerens, and Shimbo 2016, 36</a>)</span>, when we start with node 1, things get relatively quickly to node 17 (<span class="math inline">\(\hat{t} = 8.7\)</span>) but they take forever to get to node 13 (<span class="math inline">\(\hat{t} = 86.8\)</span>).</p>
<p>We can of course, write a wrapper around the <code>first.pass1</code> function to compute the average first passage time from one node to another using every node in the graph as the initial seed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>   first.pass2 <span class="ot">&lt;-</span> <span class="cf">function</span>(w, n) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>      m <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(<span class="fu">replicate</span>(n, <span class="fu">first.pass1</span>(w)))</span>
<span id="cb6-3"><a href="#cb6-3"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(w)) {</span>
<span id="cb6-4"><a href="#cb6-4"></a>         m <span class="ot">&lt;-</span> <span class="fu">rbind</span>(m, <span class="fu">rowMeans</span>(<span class="fu">replicate</span>(n, <span class="fu">first.pass1</span>(w, <span class="at">seed =</span> i))))</span>
<span id="cb6-5"><a href="#cb6-5"></a>      }</span>
<span id="cb6-6"><a href="#cb6-6"></a>   <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(w)</span>
<span id="cb6-7"><a href="#cb6-7"></a>   <span class="fu">return</span>(m)</span>
<span id="cb6-8"><a href="#cb6-8"></a>   }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And the result (showing the first ten rows and columns) is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>   <span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>   <span class="fu">round</span>(<span class="fu">first.pass2</span>(P, <span class="dv">100</span>), <span class="dv">1</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1    2    3    4    5    6    7    8    9   10
1   0.0 16.1 32.9 21.2 17.2 24.4 60.0 27.8 25.9 17.8
2  18.1  0.0 23.4 24.0 14.6 20.5 60.6 32.6 32.6 16.6
3  20.6 22.2  0.0 19.9 17.1 29.1 63.1 29.8 26.8 19.0
4  14.1 14.1 27.4  0.0 18.1 21.7 57.8 28.9 22.7 21.8
5  16.9 16.7 30.0 25.1  0.0 25.0 52.9 36.5 19.9 24.1
6  19.5 18.1 24.4 28.2 15.2  0.0 41.5 38.6 19.5 25.2
7  20.7 15.9 26.8 24.8 16.3 14.2  0.0 33.0 26.1 23.7
8  14.1 14.9 27.2 16.6 17.2 29.2 73.3  0.0 23.8 19.1
9  18.1 16.1 27.5 23.9 16.3 20.7 52.1 32.7  0.0 20.1
10 20.0 18.7 26.2 23.3 16.2 23.8 64.7 27.0 21.2  0.0</code></pre>
</div>
</div>
<p>The accuracy of the average first passage time estimate we get depends on the number of replications we use to get the average. The bigger, the more accurate. However, it can take a lot of computing time if we increased <code>n</code> to a giant number.</p>
</section>
<section id="iterating-until-convergence" class="level2">
<h2 class="anchored" data-anchor-id="iterating-until-convergence">Iterating Until Convergence</h2>
<p>There’s another approach to computing the average first passage time that involves iterating through a matrix using the information in the transition matrix. The basic idea is that the average first passage time for a random walker that starts at node <span class="math inline">\(i\)</span> and ends at node <span class="math inline">\(j\)</span> is given by:</p>
<p><span class="math display">\[
m_{ij} = 1 + \sum^N_{j \neq k}p_{ik}m_{k,j}
\]</span></p>
<p>With the proviso that <span class="math inline">\(m_{ii}\)</span> is always equal to zero. What this tells us is that the average first passage time between any two nodes in the graph <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, is given by one plus the product probability that something can transition from a sender node <span class="math inline">\(i\)</span> to an intermediary node <span class="math inline">\(k\)</span>—given by <span class="math inline">\(p_{ik}\)</span>—and <span class="math inline">\(m_{kj}\)</span> which is the average first passage time from that intermediary node <span class="math inline">\(k\)</span> to the destination node <span class="math inline">\(j\)</span>.</p>
<p>Note that since we need to know <span class="math inline">\(m_{kj}\)</span> to get <span class="math inline">\(m_{ij}\)</span>, then this opens up a chicken or the egg problem that we can solve through iteration like we did for the status scores in the <a href="./prestige.html">prestige</a> lesson. That is, we first start with a null value for all the entries of the <span class="math inline">\(\mathbf{M}\)</span> matrix (e.g., <span class="math inline">\(m_{ij} = 0\)</span> for all <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>), compute an initial round of <span class="math inline">\(m_{ij}\)</span> estimates for all pairs of nodes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> using the equation above, recompute <span class="math inline">\(m_{ij}\)</span> using those new values, rinse, repeat, and stop after we don’t get any changes between successive versions of the <span class="math inline">\(\mathbf{M}\)</span> matrix.</p>
<p>A function that implement this idea goes like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>   first.pass3 <span class="ot">&lt;-</span> <span class="cf">function</span>(w) {</span>
<span id="cb9-2"><a href="#cb9-2"></a>      n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(w)</span>
<span id="cb9-3"><a href="#cb9-3"></a>      nodes <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb9-4"><a href="#cb9-4"></a>      m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, n) <span class="co">#initializing M matrix values</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>      <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb9-6"><a href="#cb9-6"></a>      <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb9-7"><a href="#cb9-7"></a>      d <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>      z <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>      <span class="cf">while</span>(d <span class="sc">&gt;</span> <span class="fl">1e-05</span>) {</span>
<span id="cb9-10"><a href="#cb9-10"></a>      old.m <span class="ot">&lt;-</span> m</span>
<span id="cb9-11"><a href="#cb9-11"></a>      <span class="cf">for</span> (i <span class="cf">in</span> nodes) { <span class="co">#loop through every node</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>         <span class="cf">for</span> (j <span class="cf">in</span> nodes[<span class="sc">-</span>i]) { <span class="co">#loop through every node except i</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>            m[i,j] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>            <span class="cf">for</span> (k <span class="cf">in</span> nodes[<span class="sc">-</span>j]) { <span class="co">#loop through every node except i and j</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>               m[i,j] <span class="ot">&lt;-</span> m[i,j] <span class="sc">+</span> (w[i,k]<span class="sc">*</span>old.m[k,j]) <span class="co">#update M matrix values</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>               }</span>
<span id="cb9-17"><a href="#cb9-17"></a>            }</span>
<span id="cb9-18"><a href="#cb9-18"></a>         }</span>
<span id="cb9-19"><a href="#cb9-19"></a>      z <span class="ot">&lt;-</span> z <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>      d <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(<span class="fu">abs</span>(m) <span class="sc">-</span> <span class="fu">abs</span>(old.m))) <span class="co">#difference between current and previous M matrix</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>      } <span class="co">#end while loop</span></span>
<span id="cb9-22"><a href="#cb9-22"></a>      <span class="fu">return</span>(m)</span>
<span id="cb9-23"><a href="#cb9-23"></a>   }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function takes the probability transition matrix <span class="math inline">\(\mathbf{P}\)</span> as input and returns <span class="math inline">\(\mathbf{M}\)</span> a matrix of average first passage times between every pair of nodes in the network.</p>
<p>And the result is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>   <span class="fu">round</span>(<span class="fu">first.pass3</span>(P), <span class="dv">1</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1    2    3    4    5    6    7    8    9   10
1   0.0 15.0 28.5 21.1 17.7 25.4 59.7 29.9 28.5 21.2
2  17.0  0.0 29.0 22.3 16.1 23.2 59.0 33.8 28.2 21.8
3  19.1 17.7  0.0 25.7 16.6 25.4 57.6 34.1 27.4 18.6
4  15.1 14.4 29.1  0.0 18.0 25.6 59.9 28.6 28.7 20.9
5  19.4 15.8 27.6 25.7  0.0 24.8 58.4 34.5 25.1 19.9
6  19.3 15.0 28.6 25.3 16.9  0.0 50.5 35.0 24.2 21.8
7  19.9 17.3 27.1 26.1 17.0 16.9  0.0 35.2 27.1 22.2
8  14.9 16.8 28.3 19.5 17.8 26.1 59.9  0.0 28.0 17.7
9  19.4 17.2 27.7 25.6 14.4 21.3 57.8 34.1  0.0 18.4
10 18.7 17.3 25.4 24.3 15.7 25.4 59.4 30.2 24.9  0.0</code></pre>
</div>
</div>
<p>Which are values pretty close to the ones we obtained by averaging earlier.</p>
</section>
<section id="using-the-laplacian-matrix" class="level2">
<h2 class="anchored" data-anchor-id="using-the-laplacian-matrix">Using the Laplacian Matrix</h2>
<p>Finally, there is a way to use matrix algebra magic to compute the average first pass at the limit (<span class="math inline">\(n \approx \infty\)</span>) in closed form without averaging or iterations.</p>
<p>To do that, first we need to compute a matrix called the <strong>graph Laplacian</strong>, which is defined as:</p>
<p><span class="math display">\[
\mathbf{L} = \mathbf{D} - \mathbf{A}
\]</span></p>
<p>Where <span class="math inline">\(\mathbf{D}\)</span> is a diagonal matrix containing the degrees of each node in the graph along the diagonals and zeroes everywhere else.</p>
<p>In <code>R</code> we can compute <span class="math inline">\(\mathbf{L}\)</span> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>   D <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">rowSums</span>(A))</span>
<span id="cb12-2"><a href="#cb12-2"></a>   L <span class="ot">&lt;-</span> D <span class="sc">-</span> A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have <span class="math inline">\(\mathbf{L}\)</span>, we need to compute a variation known by the less than memorable name of the <strong>Moore-Penrose Pseudo-Inverse</strong> of the Laplacian, written as <span class="math inline">\(\mathbf{L}^+\)</span>.</p>
<p>Despite the terrible name, <span class="math inline">\(\mathbf{L}^+\)</span> is easy to compute:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>   E <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">nrow</span>(A), <span class="fu">nrow</span>(A), <span class="fu">nrow</span>(A))</span>
<span id="cb13-2"><a href="#cb13-2"></a>   L.plus <span class="ot">&lt;-</span> <span class="fu">solve</span>(L <span class="sc">-</span> E) <span class="sc">+</span> E</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see, <code>E</code> is just a matrix containing the inverse of the number of nodes in the network in every cell.</p>
<p>Now, the average first passage time between every pair of nodes in the network, contained in the matrix <span class="math inline">\(\mathbf{M}\)</span> is given by:</p>
<p><span class="math display">\[
\mathbf{M} = vol(A)(\mathbf{e}\mathbf{L}^+_{diag})^T - vol(A)\mathbf{L}^+ + (\mathbf{L}^+\mathbf{d})\mathbf{e}^T -\mathbf{e}(\mathbf{d}^T\mathbf{L}^+)
\]</span></p>
<p>Now, this formula looks long and monstrous but it is composed of simple quantities we know and love. We have already been introduced to <span class="math inline">\(\mathbf{L}^+\)</span>, while <span class="math inline">\(vol(A) = \sum_{ij} a_{ij}\)</span> is just the sum of the non-zero entries in the adjacency matrix, <span class="math inline">\(\mathbf{e}\)</span> is a column vector of ones with as many rows as the number of nodes in the graph, <span class="math inline">\(\mathbf{d}\)</span> is a vector of the same length as the number of nodes in the graph containing the degrees of each node at each position, and <span class="math inline">\(\mathbf{L}^+_{diag}\)</span> is a vector containing the diagonal entries of <span class="math inline">\(\mathbf{L}^+\)</span> at each position.</p>
<p>The following <code>R</code> code constructs <span class="math inline">\(\mathbf{M}\)</span> step by step:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>   e <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(A), <span class="dv">1</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a>   d <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(A)</span>
<span id="cb14-3"><a href="#cb14-3"></a>   M <span class="ot">&lt;-</span> <span class="fu">sum</span>(A) <span class="sc">*</span> <span class="fu">t</span>(e <span class="sc">%*%</span> <span class="fu">diag</span>(L.plus))</span>
<span id="cb14-4"><a href="#cb14-4"></a>   M <span class="ot">&lt;-</span> M <span class="sc">-</span> (<span class="fu">sum</span>(A) <span class="sc">*</span> L.plus)</span>
<span id="cb14-5"><a href="#cb14-5"></a>   M <span class="ot">&lt;-</span> M <span class="sc">+</span> (L.plus <span class="sc">%*%</span> d) <span class="sc">%*%</span> <span class="fu">t</span>(e)</span>
<span id="cb14-6"><a href="#cb14-6"></a>   M <span class="ot">&lt;-</span> M <span class="sc">-</span> (e <span class="sc">%*%</span> (<span class="fu">t</span>(d) <span class="sc">%*%</span> L.plus))</span>
<span id="cb14-7"><a href="#cb14-7"></a>   <span class="fu">rownames</span>(M) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(A)</span>
<span id="cb14-8"><a href="#cb14-8"></a>   <span class="fu">colnames</span>(M) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(A)</span>
<span id="cb14-9"><a href="#cb14-9"></a>   M <span class="ot">&lt;-</span> <span class="fu">t</span>(M)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now for the big reveal:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>   <span class="fu">round</span>(M, <span class="dv">1</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1    2    3    4    5    6    7    8    9   10
1   0.0 14.9 27.7 20.6 17.3 24.5 56.1 28.8 27.6 20.6
2  17.1  0.0 28.4 22.0 15.8 22.3 55.5 32.8 27.6 21.3
3  19.9 18.3  0.0 26.0 16.9 25.3 54.7 33.7 27.3 18.8
4  15.6 14.8 28.8  0.0 18.1 25.1 56.8 27.9 28.4 20.8
5  19.9 16.1 27.3 25.6  0.0 24.3 55.3 33.8 24.7 19.8
6  20.2 15.8 28.8 25.8 17.5  0.0 47.8 34.8 24.3 22.1
7  23.6 20.8 30.0 29.2 20.2 19.6  0.0 37.7 29.9 25.2
8  16.0 17.8 28.7 20.1 18.5 26.3 57.4  0.0 28.4 18.2
9  20.2 17.9 27.7 26.0 14.7 21.2 55.0 33.7  0.0 18.6
10 19.3 17.8 25.3 24.4 15.9 25.1 56.4 29.7 24.7  0.0</code></pre>
</div>
</div>
<p>Which shows entries pretty close in value to the ones we obtained by iteration and averaging.</p>
</section>
<section id="the-average-commute-distance" class="level2">
<h2 class="anchored" data-anchor-id="the-average-commute-distance">The Average Commute Distance</h2>
<p>Once we have the average first passage time, we can compute another important quantity called the <strong>average commute distance</strong> between two nodes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> (<span class="math inline">\(n_{ij}\)</span>). This is the number of steps it takes for a random walker to start at node <span class="math inline">\(i\)</span>, reach another specific node <span class="math inline">\(j\)</span> and then <em>get back</em> to the original node <span class="math inline">\(i\)</span> (hence commuting, like going fromm to work and back home again).</p>
<p>It turns out that <span class="math inline">\(n_{ij}\)</span> is pretty simple to compute, once we know the average first passage time between every pair of nodes <span class="math inline">\(m_{ij}\)</span>, since it is given by:</p>
<p><span class="math display">\[
   n_{ij} = m_{ij} + m_{ji}
\]</span></p>
<p>So the Average Commute Distance is just the entries of <span class="math inline">\(\mathbf{M}\)</span> on the upper triangle added to the corresponding entries in the lower triangle:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>   N <span class="ot">&lt;-</span> M <span class="sc">+</span> <span class="fu">t</span>(M)</span>
<span id="cb17-2"><a href="#cb17-2"></a>   <span class="fu">round</span>(N[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1    2    3    4    5    6    7    8    9   10
1   0.0 32.0 47.6 36.2 37.1 44.7 79.6 44.8 47.9 39.9
2  32.0  0.0 46.7 36.7 31.9 38.2 76.3 50.6 45.5 39.0
3  47.6 46.7  0.0 54.8 44.2 54.0 84.7 62.4 55.0 44.0
4  36.2 36.7 54.8  0.0 43.7 50.9 86.0 48.1 54.4 45.2
5  37.1 31.9 44.2 43.7  0.0 41.8 75.4 52.3 39.5 35.6
6  44.7 38.2 54.0 50.9 41.8  0.0 67.4 61.1 45.5 47.2
7  79.6 76.3 84.7 86.0 75.4 67.4  0.0 95.1 84.9 81.6
8  44.8 50.6 62.4 48.1 52.3 61.1 95.1  0.0 62.1 47.9
9  47.9 45.5 55.0 54.4 39.5 45.5 84.9 62.1  0.0 43.3
10 39.9 39.0 44.0 45.2 35.6 47.2 81.6 47.9 43.3  0.0</code></pre>
</div>
</div>
<p>Note that the entries in this matrix are symmetric (it takes as long for something to go from to you to me and back to you as from me to you and back to me). They thus function as a <strong>similarity metric</strong> between nodes; the lower the average commute distance, the closer or more similar the two nodes are.</p>
<p>Of course, there’s also math to compute <span class="math inline">\(\mathbf{N}\)</span> directly from <span class="math inline">\(\mathbf{L}^+\)</span> using the same ingredients we used before. It goes like this:</p>
<p><span class="math display">\[
\mathbf{N} = (\mathbf{L}^+_{diag}\mathbf{e}^T + \mathbf{e}\mathbf{L}^+_{diag} - 2\mathbf{L}^+)vol(A)
\]</span></p>
<p>Which is actually a much less monstrous and simpler expression than before.</p>
<p>The following <code>R</code> code constructs <span class="math inline">\(\mathbf{N}\)</span> step by step:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>   N <span class="ot">&lt;-</span> <span class="fu">diag</span>(L.plus) <span class="sc">%*%</span> <span class="fu">t</span>(e)</span>
<span id="cb19-2"><a href="#cb19-2"></a>   N <span class="ot">&lt;-</span> N <span class="sc">+</span> (e <span class="sc">%*%</span> <span class="fu">diag</span>(L.plus))</span>
<span id="cb19-3"><a href="#cb19-3"></a>   N <span class="ot">&lt;-</span> N <span class="sc">-</span> (<span class="dv">2</span> <span class="sc">*</span> L.plus)</span>
<span id="cb19-4"><a href="#cb19-4"></a>   N <span class="ot">&lt;-</span> N <span class="sc">*</span> <span class="fu">sum</span>(A)</span>
<span id="cb19-5"><a href="#cb19-5"></a>   <span class="fu">round</span>(N, <span class="dv">1</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
 [1,]  0.0 32.0 47.6 36.2 37.1 44.7 79.6 44.8 47.9  39.9
 [2,] 32.0  0.0 46.7 36.7 31.9 38.2 76.3 50.6 45.5  39.0
 [3,] 47.6 46.7  0.0 54.8 44.2 54.0 84.7 62.4 55.0  44.0
 [4,] 36.2 36.7 54.8  0.0 43.7 50.9 86.0 48.1 54.4  45.2
 [5,] 37.1 31.9 44.2 43.7  0.0 41.8 75.4 52.3 39.5  35.6
 [6,] 44.7 38.2 54.0 50.9 41.8  0.0 67.4 61.1 45.5  47.2
 [7,] 79.6 76.3 84.7 86.0 75.4 67.4  0.0 95.1 84.9  81.6
 [8,] 44.8 50.6 62.4 48.1 52.3 61.1 95.1  0.0 62.1  47.9
 [9,] 47.9 45.5 55.0 54.4 39.5 45.5 84.9 62.1  0.0  43.3
[10,] 39.9 39.0 44.0 45.2 35.6 47.2 81.6 47.9 43.3   0.0</code></pre>
</div>
</div>
<p>Which as you can see, gives us the results we seek.</p>
<p>Interestingly, we can obtain the average commute time distance between any pair nodes yet another way. For instance from the above matrix, we know the average commute time distances between nodes 3 and 8 is 62.38.</p>
<p>Let’s construct two vectors full of zeros of the same length as the number of nodes in the graph, except they have a one in the third and eighth spot respectively:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>   n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(A)</span>
<span id="cb21-2"><a href="#cb21-2"></a>   i <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb21-3"><a href="#cb21-3"></a>   j <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb21-4"><a href="#cb21-4"></a>   i[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>   j[<span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="citation" data-cites="fouss_etal04b">Fouss, Pirotte, and Saerens (<a href="#ref-fouss_etal04b" role="doc-biblioref">2004</a>)</span> show that the average commute time distance between nodes 3 and 8 is also given by:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>   <span class="fu">round</span>(<span class="fu">sum</span>(A) <span class="sc">*</span> (<span class="fu">t</span>((i <span class="sc">-</span> j)) <span class="sc">%*%</span> L.plus <span class="sc">%*%</span> (i <span class="sc">-</span> j)), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]
[1,] 62.38</code></pre>
</div>
</div>
<p>Neat!</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-fouss_etal04b" class="csl-entry" role="doc-biblioentry">
Fouss, François, Alain Pirotte, and Marco Saerens. 2004. <span>“The Application of New Concepts of Dissimilarities Between Nodes of a Graph to Collaborative Filtering.”</span> In <em>Proc. Workshop on Statistical Approaches for Web Mining</em>, 26–37.
</div>
<div id="ref-fouss_etal16" class="csl-entry" role="doc-biblioentry">
Fouss, François, Marco Saerens, and Masashi Shimbo. 2016. <em>Algorithms and Models for Network Data and Link Analysis</em>. Cambridge University Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>