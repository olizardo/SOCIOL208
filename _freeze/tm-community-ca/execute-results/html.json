{
  "hash": "42b011a14484a47d0ae7fd56d6ba4ae1",
  "result": {
    "markdown": "---\ntitle: \"Community Detection in Two-Mode Networks Using CA\"\nexecute: \n  eval: true\n  echo: true\n  output: true\n  warning: false\n  message: false\nformat: \n   html:\n      code-line-numbers: true\n---\n\n\nYou may have noticed that the [CA analysis of two-mode networks](tm-ca.qmd) looks a lot like the identification of communities in one-mode networks. The main difference is that in a two-mode network, good communities are composed of clusters of persons and groups well-separated from other clusters of persons and groups. \n\nAs @barber07 noted, we can extend Newman's modularity approach to ascertain whether a given partition identifies a good \"community\" in the bipartite case. For that, we need a bi-adjacency analog of the modularity matrix $\\mathbf{B}$. This is given by:\n\n$$\n\\mathbf{B}_{(ij)} = \\mathbf{A}_{(ij)} - \\frac{k^p_ik^g_j}{|E|}\n$$\n\nWhere $k^p_i$ is the number of memberships of the $i^{th}$ person, $k^g_i$ is the number of members of the $j^{th}$ group, and $|E|$ is the number of edges in the bipartite graph.\n\nSo in the *Southern Women* data case, this would be:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n    library(networkdata)\n    library(igraph)\n    g <- southern_women\n    A <- as_biadjacency_matrix(g)\n    dp <- as.matrix(rowSums(A))\n    dg <- as.matrix(colSums(A))\n    dpdg <- dp %*% t(dg) #person x group degree product matrix\n    B <- A - dpdg/sum(A)\n    round(B, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           6/27   3/2  4/12  9/26  2/25  5/19  3/15  9/16   4/8  6/10  2/23\nEVELYN     0.73  0.73  0.46  0.64  0.28  0.28 -0.90 -0.26 -0.08 -0.45 -0.36\nLAURA      0.76  0.76  0.53 -0.31  0.37  0.37  0.21 -0.10 -0.94 -0.39 -0.31\nTHERESA   -0.27  0.73  0.46  0.64  0.28  0.28  0.10 -0.26 -0.08 -0.45 -0.36\nBRENDA     0.76 -0.24  0.53  0.69  0.37  0.37  0.21 -0.10 -0.94 -0.39 -0.31\nCHARLOTTE -0.13 -0.13  0.73  0.82  0.64 -0.36  0.55 -0.63 -0.54 -0.22 -0.18\nFRANCES   -0.13 -0.13  0.73 -0.18  0.64  0.64 -0.45  0.37 -0.54 -0.22 -0.18\nELEANOR   -0.13 -0.13 -0.27 -0.18  0.64  0.64  0.55  0.37 -0.54 -0.22 -0.18\nPEARL     -0.10 -0.10 -0.20 -0.13 -0.27  0.73 -0.34  0.53  0.60 -0.17 -0.13\nRUTH      -0.13 -0.13 -0.27 -0.18  0.64 -0.36  0.55  0.37  0.46 -0.22 -0.18\nVERNE     -0.13 -0.13 -0.27 -0.18 -0.36 -0.36  0.55  0.37  0.46 -0.22 -0.18\nMYRNA     -0.13 -0.13 -0.27 -0.18 -0.36 -0.36 -0.45  0.37  0.46  0.78 -0.18\nKATHERINE -0.20 -0.20 -0.40 -0.27 -0.54 -0.54 -0.67  0.06  0.19  0.66 -0.27\nSYLVIA    -0.24 -0.24 -0.47 -0.31 -0.63 -0.63  0.21 -0.10  0.06  0.61 -0.31\nNORA      -0.27 -0.27 -0.54 -0.36 -0.72  0.28  0.10 -1.26 -0.08  0.55  0.64\nHELEN     -0.17 -0.17 -0.34 -0.22 -0.45 -0.45  0.44  0.21 -0.67  0.72  0.78\nDOROTHY   -0.07 -0.07 -0.13 -0.09 -0.18 -0.18 -0.22  0.69  0.73 -0.11 -0.09\nOLIVIA    -0.07 -0.07 -0.13 -0.09 -0.18 -0.18 -0.22 -0.31  0.73 -0.11  0.91\nFLORA     -0.07 -0.07 -0.13 -0.09 -0.18 -0.18 -0.22 -0.31  0.73 -0.11  0.91\n            4/7 11/21   8/3\nEVELYN    -0.54 -0.27 -0.27\nLAURA     -0.47 -0.24 -0.24\nTHERESA   -0.54 -0.27 -0.27\nBRENDA    -0.47 -0.24 -0.24\nCHARLOTTE -0.27 -0.13 -0.13\nFRANCES   -0.27 -0.13 -0.13\nELEANOR   -0.27 -0.13 -0.13\nPEARL     -0.20 -0.10 -0.10\nRUTH      -0.27 -0.13 -0.13\nVERNE      0.73 -0.13 -0.13\nMYRNA      0.73 -0.13 -0.13\nKATHERINE  0.60  0.80  0.80\nSYLVIA     0.53  0.76  0.76\nNORA       0.46  0.73  0.73\nHELEN      0.66 -0.17 -0.17\nDOROTHY   -0.13 -0.07 -0.07\nOLIVIA    -0.13 -0.07 -0.07\nFLORA     -0.13 -0.07 -0.07\n```\n:::\n:::\n\n\nNeat! Like before the numbers in this matrix represent the expected probability of observing a tie in a world in which people keep their number of memberships and groups keep their observed sizes, but otherwise, people and groups connect at random. \n\nWe can also create a bipartite matrix version of the bi-adjacency modularity, as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n   n <- vcount(g)\n   Np <- nrow(A)\n   names <- c(rownames(A), colnames(A))\n   B2 <- matrix(0, n, n) #all zeros matrix of dimensions (p + g) X (p + g)\n   B2[1:Np, (Np + 1):n] <- B #putting B in the top right block\n   B2[(Np + 1):n, 1:Np] <- t(B) #putting B transpose in the lower-left block\n   rownames(B2) <- names\n   colnames(B2) <- names\n   round(B2, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          EVELYN LAURA THERESA BRENDA CHARLOTTE FRANCES ELEANOR PEARL  RUTH\nEVELYN      0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nLAURA       0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nTHERESA     0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nBRENDA      0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nCHARLOTTE   0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nFRANCES     0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nELEANOR     0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nPEARL       0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nRUTH        0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nVERNE       0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nMYRNA       0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nKATHERINE   0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nSYLVIA      0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nNORA        0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nHELEN       0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nDOROTHY     0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nOLIVIA      0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\nFLORA       0.00  0.00    0.00   0.00      0.00    0.00    0.00  0.00  0.00\n6/27        0.73  0.76   -0.27   0.76     -0.13   -0.13   -0.13 -0.10 -0.13\n3/2         0.73  0.76    0.73  -0.24     -0.13   -0.13   -0.13 -0.10 -0.13\n4/12        0.46  0.53    0.46   0.53      0.73    0.73   -0.27 -0.20 -0.27\n9/26        0.64 -0.31    0.64   0.69      0.82   -0.18   -0.18 -0.13 -0.18\n2/25        0.28  0.37    0.28   0.37      0.64    0.64    0.64 -0.27  0.64\n5/19        0.28  0.37    0.28   0.37     -0.36    0.64    0.64  0.73 -0.36\n3/15       -0.90  0.21    0.10   0.21      0.55   -0.45    0.55 -0.34  0.55\n9/16       -0.26 -0.10   -0.26  -0.10     -0.63    0.37    0.37  0.53  0.37\n4/8        -0.08 -0.94   -0.08  -0.94     -0.54   -0.54   -0.54  0.60  0.46\n6/10       -0.45 -0.39   -0.45  -0.39     -0.22   -0.22   -0.22 -0.17 -0.22\n2/23       -0.36 -0.31   -0.36  -0.31     -0.18   -0.18   -0.18 -0.13 -0.18\n4/7        -0.54 -0.47   -0.54  -0.47     -0.27   -0.27   -0.27 -0.20 -0.27\n11/21      -0.27 -0.24   -0.27  -0.24     -0.13   -0.13   -0.13 -0.10 -0.13\n8/3        -0.27 -0.24   -0.27  -0.24     -0.13   -0.13   -0.13 -0.10 -0.13\n          VERNE MYRNA KATHERINE SYLVIA  NORA HELEN DOROTHY OLIVIA FLORA  6/27\nEVELYN     0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00  0.73\nLAURA      0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00  0.76\nTHERESA    0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.27\nBRENDA     0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00  0.76\nCHARLOTTE  0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.13\nFRANCES    0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.13\nELEANOR    0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.13\nPEARL      0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.10\nRUTH       0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.13\nVERNE      0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.13\nMYRNA      0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.13\nKATHERINE  0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.20\nSYLVIA     0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.24\nNORA       0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.27\nHELEN      0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.17\nDOROTHY    0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.07\nOLIVIA     0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.07\nFLORA      0.00  0.00      0.00   0.00  0.00  0.00    0.00   0.00  0.00 -0.07\n6/27      -0.13 -0.13     -0.20  -0.24 -0.27 -0.17   -0.07  -0.07 -0.07  0.00\n3/2       -0.13 -0.13     -0.20  -0.24 -0.27 -0.17   -0.07  -0.07 -0.07  0.00\n4/12      -0.27 -0.27     -0.40  -0.47 -0.54 -0.34   -0.13  -0.13 -0.13  0.00\n9/26      -0.18 -0.18     -0.27  -0.31 -0.36 -0.22   -0.09  -0.09 -0.09  0.00\n2/25      -0.36 -0.36     -0.54  -0.63 -0.72 -0.45   -0.18  -0.18 -0.18  0.00\n5/19      -0.36 -0.36     -0.54  -0.63  0.28 -0.45   -0.18  -0.18 -0.18  0.00\n3/15       0.55 -0.45     -0.67   0.21  0.10  0.44   -0.22  -0.22 -0.22  0.00\n9/16       0.37  0.37      0.06  -0.10 -1.26  0.21    0.69  -0.31 -0.31  0.00\n4/8        0.46  0.46      0.19   0.06 -0.08 -0.67    0.73   0.73  0.73  0.00\n6/10      -0.22  0.78      0.66   0.61  0.55  0.72   -0.11  -0.11 -0.11  0.00\n2/23      -0.18 -0.18     -0.27  -0.31  0.64  0.78   -0.09   0.91  0.91  0.00\n4/7        0.73  0.73      0.60   0.53  0.46  0.66   -0.13  -0.13 -0.13  0.00\n11/21     -0.13 -0.13      0.80   0.76  0.73 -0.17   -0.07  -0.07 -0.07  0.00\n8/3       -0.13 -0.13      0.80   0.76  0.73 -0.17   -0.07  -0.07 -0.07  0.00\n            3/2  4/12  9/26  2/25  5/19  3/15  9/16   4/8  6/10  2/23   4/7\nEVELYN     0.73  0.46  0.64  0.28  0.28 -0.90 -0.26 -0.08 -0.45 -0.36 -0.54\nLAURA      0.76  0.53 -0.31  0.37  0.37  0.21 -0.10 -0.94 -0.39 -0.31 -0.47\nTHERESA    0.73  0.46  0.64  0.28  0.28  0.10 -0.26 -0.08 -0.45 -0.36 -0.54\nBRENDA    -0.24  0.53  0.69  0.37  0.37  0.21 -0.10 -0.94 -0.39 -0.31 -0.47\nCHARLOTTE -0.13  0.73  0.82  0.64 -0.36  0.55 -0.63 -0.54 -0.22 -0.18 -0.27\nFRANCES   -0.13  0.73 -0.18  0.64  0.64 -0.45  0.37 -0.54 -0.22 -0.18 -0.27\nELEANOR   -0.13 -0.27 -0.18  0.64  0.64  0.55  0.37 -0.54 -0.22 -0.18 -0.27\nPEARL     -0.10 -0.20 -0.13 -0.27  0.73 -0.34  0.53  0.60 -0.17 -0.13 -0.20\nRUTH      -0.13 -0.27 -0.18  0.64 -0.36  0.55  0.37  0.46 -0.22 -0.18 -0.27\nVERNE     -0.13 -0.27 -0.18 -0.36 -0.36  0.55  0.37  0.46 -0.22 -0.18  0.73\nMYRNA     -0.13 -0.27 -0.18 -0.36 -0.36 -0.45  0.37  0.46  0.78 -0.18  0.73\nKATHERINE -0.20 -0.40 -0.27 -0.54 -0.54 -0.67  0.06  0.19  0.66 -0.27  0.60\nSYLVIA    -0.24 -0.47 -0.31 -0.63 -0.63  0.21 -0.10  0.06  0.61 -0.31  0.53\nNORA      -0.27 -0.54 -0.36 -0.72  0.28  0.10 -1.26 -0.08  0.55  0.64  0.46\nHELEN     -0.17 -0.34 -0.22 -0.45 -0.45  0.44  0.21 -0.67  0.72  0.78  0.66\nDOROTHY   -0.07 -0.13 -0.09 -0.18 -0.18 -0.22  0.69  0.73 -0.11 -0.09 -0.13\nOLIVIA    -0.07 -0.13 -0.09 -0.18 -0.18 -0.22 -0.31  0.73 -0.11  0.91 -0.13\nFLORA     -0.07 -0.13 -0.09 -0.18 -0.18 -0.22 -0.31  0.73 -0.11  0.91 -0.13\n6/27       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n3/2        0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n4/12       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n9/26       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n2/25       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n5/19       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n3/15       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n9/16       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n4/8        0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n6/10       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n2/23       0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n4/7        0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n11/21      0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n8/3        0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00  0.00\n          11/21   8/3\nEVELYN    -0.27 -0.27\nLAURA     -0.24 -0.24\nTHERESA   -0.27 -0.27\nBRENDA    -0.24 -0.24\nCHARLOTTE -0.13 -0.13\nFRANCES   -0.13 -0.13\nELEANOR   -0.13 -0.13\nPEARL     -0.10 -0.10\nRUTH      -0.13 -0.13\nVERNE     -0.13 -0.13\nMYRNA     -0.13 -0.13\nKATHERINE  0.80  0.80\nSYLVIA     0.76  0.76\nNORA       0.73  0.73\nHELEN     -0.17 -0.17\nDOROTHY   -0.07 -0.07\nOLIVIA    -0.07 -0.07\nFLORA     -0.07 -0.07\n6/27       0.00  0.00\n3/2        0.00  0.00\n4/12       0.00  0.00\n9/26       0.00  0.00\n2/25       0.00  0.00\n5/19       0.00  0.00\n3/15       0.00  0.00\n9/16       0.00  0.00\n4/8        0.00  0.00\n6/10       0.00  0.00\n2/23       0.00  0.00\n4/7        0.00  0.00\n11/21      0.00  0.00\n8/3        0.00  0.00\n```\n:::\n:::\n\n\nWhich is a bipartite version of modularity matrix ($\\mathbf{\\hat{B}}$) with the same block structure as the bipartite adjacency matrix:\n\n$$\n\\mathbf{\\hat{B}} = \\left[\n\\begin{matrix}\n\\mathbf{O}_{M \\times M} & \\mathbf{B}_{M \\times N} \\\\\n\\mathbf{B}^T_{N \\times M} & \\mathbf{O}_{N \\times N}\n\\end{matrix}\n\\right]\n$$\n\nNote that in $\\mathbf{\\hat{B}}$ the modularity (expected number of edges) is set to zero for nodes of the same set (people and people; groups and groups), and to non-zero values for nodes of different sets (persons and groups).\n\nNow, we can use the same approach we used in the unipartite case to check the modularity of some hypothetical partition of the nodes in the graph. \n\nTake for instance, the [CA scores in the first dimension that we saw in the lecture on CA](tm-ca.qmd). They do seem to divide the persons and groups into distinct communities. \n\nSo let's bring them back (using the `CA` function in the package `FactoMineR`and transform them into membership vectors (using dummy coding):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n    library(FactoMineR)\n    ca.res <- CA(A, graph = FALSE)\n    eig.vec.p <- ca.res$row$coord[, 1] #CA scores for persons in first dim.\n    eig.vec.g <- ca.res$col$coord[, 1] #CA scores for groups in first dim\n    u1 <- rep(0, n)\n    u2 <- rep(0, n)\n    d <- c(eig.vec.p, eig.vec.g) #original CA scores\n    d <- Re(d)\n    u1[which(d > 0)] <- 1\n    u2[which(d <= 0)] <- 1\n    U <- cbind(u1, u2)\n    rownames(U) <- rownames(B2)\n    U\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          u1 u2\nEVELYN     0  1\nLAURA      0  1\nTHERESA    0  1\nBRENDA     0  1\nCHARLOTTE  0  1\nFRANCES    0  1\nELEANOR    0  1\nPEARL      0  1\nRUTH       0  1\nVERNE      1  0\nMYRNA      1  0\nKATHERINE  1  0\nSYLVIA     1  0\nNORA       1  0\nHELEN      1  0\nDOROTHY    1  0\nOLIVIA     1  0\nFLORA      1  0\n6/27       0  1\n3/2        0  1\n4/12       0  1\n9/26       0  1\n2/25       0  1\n5/19       0  1\n3/15       0  1\n9/16       0  1\n4/8        1  0\n6/10       1  0\n2/23       1  0\n4/7        1  0\n11/21      1  0\n8/3        1  0\n```\n:::\n:::\n\n\nRecall that we can check the modularity of a partition coded in a dummy matrix like `U` using the formula:\n\n$$\n\\frac{tr(U^TBU)}{\\sum_i\\sum_ja_{ij}}\n$$\n\nWhere $tr$ is the trace matrix operation (sum of the diagonals).\n\nLet's check it out:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n   A2 <- as.matrix(as_adjacency_matrix(g))\n   round(sum(diag(t(U) %*% B2 %*% U))/sum(A2), 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.318\n```\n:::\n:::\n\n\nWhich looks pretty good!\n\nHere's a plot of the bipartite graph with nodes colored by the CA induced community bipartition:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Southern Women's bipartite graph by the best two-community partition according to CA.](tm-community-ca_files/figure-html/unnamed-chunk-5-1.png){width=1152}\n:::\n:::\n",
    "supporting": [
      "tm-community-ca_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}