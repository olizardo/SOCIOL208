<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SOCIOL 208 - Statistical Models of Networks II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="SOCIOL 208 - Statistical Models of Networks II">
<meta property="og:description" content="In this previous handout we saw how to do some basic, single-hypothesis testing against plausible null models.">
<meta property="og:site-name" content="SOCIOL 208">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Statistical Models of Networks II</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SOCIOL 208</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">208A</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-208A.html" class="sidebar-item-text sidebar-link">208A Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule-208A-F24.html" class="sidebar-item-text sidebar-link">SOCIOL 208A Reading Schedule (Fall 2024)</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Handouts</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout1.html" class="sidebar-item-text sidebar-link">Basic Network Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inoutdegdist.html" class="sidebar-item-text sidebar-link">Graph Degree Metrics in Directed Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout2.html" class="sidebar-item-text sidebar-link">Centrality</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cube.html" class="sidebar-item-text sidebar-link">The Cube</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout3.html" class="sidebar-item-text sidebar-link">Status and Prestige</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout4.html" class="sidebar-item-text sidebar-link">Role Equivalence and Structural Similarity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout5.html" class="sidebar-item-text sidebar-link">Vertex Similarity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./blondel.html" class="sidebar-item-text sidebar-link">Role Similarity Across Graphs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout6.html" class="sidebar-item-text sidebar-link">Community Structure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ahn.html" class="sidebar-item-text sidebar-link">Assigning Nodes to Multiple Communities</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout7.html" class="sidebar-item-text sidebar-link">Analyzing Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ca.html" class="sidebar-item-text sidebar-link">Correspondence Analysis (CA) of Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spectral.html" class="sidebar-item-text sidebar-link">Community Detection Using Spectral Clustering</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout8.html" class="sidebar-item-text sidebar-link">Analyzing Ego Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout9.html" class="sidebar-item-text sidebar-link">Statistical Models of Networks I</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout10.html" class="sidebar-item-text sidebar-link active">Statistical Models of Networks II</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">208B</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-208B.html" class="sidebar-item-text sidebar-link">208B Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule-208B-S24.html" class="sidebar-item-text sidebar-link">SOCIOL 208B Reading Schedule (Spring 2024)</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#exponential-random-graph-models" id="toc-exponential-random-graph-models" class="nav-link active" data-scroll-target="#exponential-random-graph-models">Exponential Random Graph Models</a></li>
  <li><a href="#fitting-ergms" id="toc-fitting-ergms" class="nav-link" data-scroll-target="#fitting-ergms">Fitting ERGMs</a></li>
  <li><a href="#fitting-a-real-ergm" id="toc-fitting-a-real-ergm" class="nav-link" data-scroll-target="#fitting-a-real-ergm">Fitting a Real ERGM</a></li>
  <li><a href="#activity-differences-based-on-a-categorical-factor" id="toc-activity-differences-based-on-a-categorical-factor" class="nav-link" data-scroll-target="#activity-differences-based-on-a-categorical-factor">Activity Differences Based on a Categorical Factor</a></li>
  <li><a href="#considering-multiple-homophily-effects" id="toc-considering-multiple-homophily-effects" class="nav-link" data-scroll-target="#considering-multiple-homophily-effects">Considering Multiple Homophily Effects</a></li>
  <li><a href="#homophily-on-a-continuous-attribute" id="toc-homophily-on-a-continuous-attribute" class="nav-link" data-scroll-target="#homophily-on-a-continuous-attribute">Homophily on a Continuous Attribute</a></li>
  <li><a href="#activity-differences-based-on-a-continuous-factor" id="toc-activity-differences-based-on-a-continuous-factor" class="nav-link" data-scroll-target="#activity-differences-based-on-a-continuous-factor">Activity Differences Based on a Continuous Factor</a></li>
  <li><a href="#heterogeneous-homophily-effects" id="toc-heterogeneous-homophily-effects" class="nav-link" data-scroll-target="#heterogeneous-homophily-effects">Heterogeneous Homophily Effects</a></li>
  <li><a href="#looking-at-combinations-of-ties-featuring-an-attribute" id="toc-looking-at-combinations-of-ties-featuring-an-attribute" class="nav-link" data-scroll-target="#looking-at-combinations-of-ties-featuring-an-attribute">Looking at combinations of ties featuring an attribute</a></li>
  <li><a href="#homophily-via-combination-of-attributes" id="toc-homophily-via-combination-of-attributes" class="nav-link" data-scroll-target="#homophily-via-combination-of-attributes">Homophily via Combination of Attributes</a></li>
  <li><a href="#checking-for-model-fit" id="toc-checking-for-model-fit" class="nav-link" data-scroll-target="#checking-for-model-fit">Checking for Model Fit</a></li>
  <li><a href="#conditioning-on-degree-and-shared-partners" id="toc-conditioning-on-degree-and-shared-partners" class="nav-link" data-scroll-target="#conditioning-on-degree-and-shared-partners">Conditioning on Degree and Shared Partners</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/olizardo/SOCIOL208/blob/main/handout10.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Statistical Models of Networks II</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this previous handout we saw how to do some basic, single-hypothesis testing against plausible null models. This approach can be thought of as <em>conditioning</em> on some set of graph level properties and seeing if something we compute in the graph obtains “net” of these conditioning (e.g., the observed degree distribution).</p>
<p>Conditioning, of course, can be thought of as the analogue of “controlling for” something in a standard linear regression model. This means that it is possible to extend the framework we explored to a setting in which we conditioning on multiple graph properties to see if what we measure obtains “net” of all these properties at th same time.</p>
<section id="exponential-random-graph-models" class="level2">
<h2 class="anchored" data-anchor-id="exponential-random-graph-models">Exponential Random Graph Models</h2>
<p>The framework of <strong>Exponential Random Graph Models</strong> (ERGMs) is useful for this purposes. There are many ways to think of ERGMs, one of them is as a network regression in which we are modeling the probability of observing each tie as a function of a bunch of tie level variables. Another way of thinking about it is as specifying a <strong>dependence structure</strong> that tell us how probability of observing a given tie depends on other things going on in the “neighborhood” of that tie, like whether one of the nodes incident to that edge is also incident to other edges <span class="citation" data-cites="pattison_robins12">(<a href="#ref-pattison_robins12" role="doc-biblioref">Pattison and Robins 2002</a>)</span>.</p>
<p>Formally, this means that an Exponential Random Graph Model is a probabilistic (auto)“regression” model in which the network itself, considered as a random variable (<span class="math inline">\(\mathbf{Y}\)</span>) is the main outcome and the specified patterns of local dependence are the main predictors:</p>
<p><span class="math display">\[
    Pr(\mathbf{Y} = \mathbf{y}) = \frac{exp\left[\theta^T S(\mathbf{y})\right] h(\mathbf{y})}{\kappa(\theta)}
\]</span></p>
<p>This means that the probability of observing a particular realization of the network (<span class="math inline">\(Pr(\mathbf{Y} = \mathbf{y})\)</span>) is a function of a given set of local structural configurations defined on the same network (<span class="math inline">\(S(\mathbf{y})\)</span>) with the parameter <span class="math inline">\(\theta\)</span> specifying the form of the dependence (e.g., positive or negative) of that local structural factor.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Note that if the we take the natural logarithm of the numerator above it leads to the usual additive linear model expression:</p>
<p><span class="math display">\[
log(exp\left[\theta^T S(\mathbf{y})\right]) = \theta_1s_1(y) + \theta_2s_2(y) + \theta_3s_3(y) + \ldots \theta_ps_p(y)
\]</span></p>
<p>Where <span class="math inline">\(p\)</span> is the number of terms included in the model. Each <span class="math inline">\(S_p\)</span> is thus a network <em>statistic</em> specifying counts of specific configurations (e.g., dyads or triads of a certain type, or links beginning at a particular type of node). When <span class="math inline">\(\theta\)</span> is positive, the existence of a given configuration enhances the probability of observing a link contained in it, while when it is negative <span class="math inline">\(\theta\)</span> is positive, the same configuration depresses the respective probability.</p>
<p>The whole network, therefore, is seen as being generated by the entire ensemble of local structural mechanisms operating in tandem. This means that each ergm also specifies a probability distribution of graphs that are generated by the model’s parameters.</p>
</section>
<section id="fitting-ergms" class="level2">
<h2 class="anchored" data-anchor-id="fitting-ergms">Fitting ERGMs</h2>
<p>This is all very abstract, so let’s see how it works in practice. First, we need a package to estimate ERGMs. Thankfully, there is one, called (predictably) <code>ergm</code> (which is dependent on the package <code>network</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>   <span class="fu">library</span>(networkdata)</span>
<span id="cb1-2"><a href="#cb1-2"></a>   <span class="fu">library</span>(igraph)</span>
<span id="cb1-3"><a href="#cb1-3"></a>   <span class="co">#install.packages("network")</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>   <span class="co">#install.packages("ergm")</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>   <span class="co">#install.packages("intergraph")</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>   <span class="fu">library</span>(ergm)</span>
<span id="cb1-7"><a href="#cb1-7"></a>   <span class="fu">library</span>(intergraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s bring back the friendship network from Krackhardt’s 21 high tech managers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>   g <span class="ot">&lt;-</span> ht_friends</span>
<span id="cb2-2"><a href="#cb2-2"></a>   g <span class="ot">&lt;-</span> <span class="fu">as_undirected</span>(g, <span class="at">mode =</span> <span class="st">"collapse"</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>   n <span class="ot">&lt;-</span> <span class="fu">asNetwork</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we use the function <code>asNetwork</code> from the <code>intergraph</code> package to coerce the <code>igraph</code> object into something that the package <code>ergm</code> can work with (namely, a <code>network</code> object).</p>
<p>And, now, let’s fit an ergm!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>   m1 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges)</span>
<span id="cb3-2"><a href="#cb3-2"></a>   <span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges)

Maximum Likelihood Results:

      Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges  -0.5057     0.1424      0   -3.55 0.000385 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 278.1  on 209  degrees of freedom
 
AIC: 280.1  BIC: 283.5  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>The typical structure of an <code>ergm</code> call is modeled after the linear regression models <code>R</code> functions like <code>lm</code> or <code>glm</code>, with dependent variable followed by squiggly symbol followed by an additive list of independent variables of the form <code>y ~ x</code>.</p>
<p>The output which we can check out by using the function <code>summary</code> on the resulting object, is also pretty similar to the typical outputs of linear model functions in <code>R</code>. We have a table with the independent variable <code>edges</code>, followed by a coefficient estimate, and some kind of p-value against the null hypothesis that that estimate is zero. Which in this case we can reject pretty handily (<span class="math inline">\(Z = - 3.55\)</span>, <span class="math inline">\(p &lt; 0.01\)</span>).</p>
<p>What is <code>edges</code>? Well as we said before, the independent variables in ergm are just counts of stuff that’s going on in the network, to predict…the network!</p>
<p>In this case, <code>edges</code> fits the number of edges in the network, which means that it fits anything that is a function of this number, like the <strong>density</strong> (or the <strong>average degree</strong>).</p>
<p>In fact, the coefficient estimate of the <code>edges</code> parameters without any other network covariates <em>is</em> the density.</p>
<p>We can check this as follows, let’s transform the coefficient estimate from the logit to the probability scale:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>   m1<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     edges 
-0.5057495 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>   <span class="fu">exp</span>(m1<span class="sc">$</span>coefficients)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(m1<span class="sc">$</span>coefficients))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    edges 
0.3761905 </code></pre>
</div>
</div>
<p>This probability estimate is the same as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>   <span class="fu">edge_density</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3761905</code></pre>
</div>
</div>
<p>That is, the expected probability of an edge existing between two randomly chosen nodes in the network, which is the same as the observed density.</p>
<p>If you like regression analogies, fitting an ergm including only the <code>edges</code> parameter and nothing else is equivalent to fitting a linear regression model with only an intercept (which returns the expected value—a.k.a., the mean—of the dependent variable).</p>
<p>As we noted, an ergm model is a model of the network that conditions on the things we put on the right-hand side of the equation, in this case, we conditioned on the density (number of edges), which means that this is an Erdos-Renyi random graph model for the observed network, like the ones we simulated using edge-swapping.</p>
<p>This also means that we can <em>simulate</em> a bunch of networks that condition on the fit of a given ergm. For this we use the function <code>simulate</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>   <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>   sim <span class="ot">&lt;-</span> <span class="fu">simulate</span>(m1, <span class="at">nsim =</span> <span class="dv">100</span>) <span class="co">#generates list of network objects</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>   sim <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim, asIgraph) <span class="co">#converts to list of igraph objects</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout10_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Original Friendship Network.</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout10_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">One ergm simulation.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout10_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Another ergm simulation.</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout10_files/figure-html/unnamed-chunk-7-4.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Yet another ergm simulation.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p>Note that the simulated networks are a <strong>graph ensemble</strong> of networks drawn from a <em>probability distribution</em> in which the <em>expected</em> (mean) density is equivalent to the observed density.</p>
<p>We can check by looking at the densities of the separate networks:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>   dens <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sim, edge_density)</span>
<span id="cb12-2"><a href="#cb12-2"></a>   <span class="fu">round</span>(dens, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 0.35 0.38 0.35 0.38 0.34 0.36 0.33 0.37 0.35 0.32 0.44 0.36 0.40 0.42 0.37
 [16] 0.39 0.39 0.46 0.37 0.36 0.33 0.37 0.40 0.36 0.40 0.42 0.40 0.39 0.36 0.35
 [31] 0.36 0.37 0.38 0.45 0.36 0.41 0.34 0.39 0.36 0.38 0.38 0.35 0.34 0.38 0.36
 [46] 0.38 0.34 0.43 0.38 0.40 0.37 0.43 0.34 0.37 0.34 0.39 0.40 0.40 0.39 0.49
 [61] 0.32 0.38 0.41 0.43 0.40 0.40 0.33 0.32 0.38 0.37 0.35 0.41 0.44 0.42 0.39
 [76] 0.38 0.38 0.40 0.38 0.38 0.36 0.37 0.38 0.35 0.37 0.37 0.40 0.43 0.42 0.43
 [91] 0.31 0.37 0.38 0.35 0.39 0.34 0.34 0.42 0.35 0.35</code></pre>
</div>
</div>
<p>Some of the values are larger and some of them are lower, but they all revolve around the estimate:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="handout10_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If we take larger and larger graph ensembles the distribution of densities would become bell-shaped and the average of the ensemble would converge around the density of the observed network.</p>
<p>So a useful way to think about ergms is as models that fix <em>expected</em> graph statistics in a given ensemble. The values of the expectations are provided by the coefficients obtained in the model for that statistic, and the range of possible variation around those expectations are given by the standard error of the estimate.</p>
</section>
<section id="fitting-a-real-ergm" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-real-ergm">Fitting a Real ERGM</h2>
<p>Of course, nobody uses the ergm package to fit single parameter Erdo-Renyi random graph models. The point is to test multivariate hypotheses of the type: Is the value of a given network effect (e.g., homophily) I observe larger or smaller than we would expect in a network with these <em>other</em> characteristics?</p>
<p>So let’s recreate our original analysis of homophily (assortativity) by managerial level from our previous analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>   m2 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"level"</span>))</span>
<span id="cb14-2"><a href="#cb14-2"></a>   <span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodematch("level"))

Maximum Likelihood Results:

                Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges            -1.0361     0.2481      0  -4.175  &lt; 1e-04 ***
nodematch.level   0.8450     0.3060      0   2.762  0.00575 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 270.1  on 208  degrees of freedom
 
AIC: 274.1  BIC: 280.8  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>Here we fit a <code>nodematch</code> term with the value of the node-characteristic “level.” This term fixes the expected number of dyads that match on this attribute to equal that observed in the network. That is, it adds a “dummy” (change score) indicator if a dyad matches on this attribute.</p>
<p>The results tell us that, net of density, there is higher likelihood of observing ties that match on this attribute (<span class="math inline">\(\theta = 0.86, p &lt;0.01\)</span>).</p>
<p>If we wanted to put a percentage, on this estimate, we could exponentiate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>   <span class="fu">exp</span>(m2<span class="sc">$</span>coefficients[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>nodematch.level 
       2.328063 </code></pre>
</div>
</div>
<p>Which tells us that there is more than 2 to 1 odds of observing connected dyads that match on level than not.</p>
</section>
<section id="activity-differences-based-on-a-categorical-factor" class="level2">
<h2 class="anchored" data-anchor-id="activity-differences-based-on-a-categorical-factor">Activity Differences Based on a Categorical Factor</h2>
<p>As we noted before, it could be that people with some values of the level variable are just more likely to form ties (e.g., the mean degree of nodes varies across the value of levels), so before we conclude that there is a lot of homophily going on, we may want to condition on the <em>expected</em> probability of a node with a given value of the level variable to show up at either end of an edge. We can do that like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>   m3 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"level"</span>, <span class="at">base =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"level"</span>))</span>
<span id="cb18-2"><a href="#cb18-2"></a>   <span class="fu">summary</span>(m3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodefactor("level", base = 2) + nodematch("level"))

Maximum Likelihood Results:

                   Estimate Std. Error MCMC % z value Pr(&gt;|z|)  
edges               -0.7035     0.4879      0  -1.442   0.1493  
nodefactor.level.1  -0.9055     0.6891      0  -1.314   0.1888  
nodefactor.level.3  -0.1587     0.4039      0  -0.393   0.6944  
nodematch.level      0.8147     0.4902      0   1.662   0.0965 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 268.1  on 206  degrees of freedom
 
AIC: 276.1  BIC: 289.5  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>The ergm term <code>nodefactor</code> uses dummy coding for the levels of a given categorical variable and fits <span class="math inline">\(k-1\)</span> terms for mean differences in degree for each category with a category serving as the (omitted) comparison. In this case, we indicate that using the <code>base</code> argument, which set the second level category as the reference.</p>
<p>As we can see, after adjusting for mean differences in degree across levels the assortativity estimate for the <code>nodematch</code> term is no longer significant at conventional levels <span class="math inline">\(p = 0.10\)</span>, indicating that heterogeneity in connectivity by nodes at different levels partially accounts for this effect (although model fit estimate prefer the more parsimonious model without <code>nodefactor</code> level effects).</p>
</section>
<section id="considering-multiple-homophily-effects" class="level2">
<h2 class="anchored" data-anchor-id="considering-multiple-homophily-effects">Considering Multiple Homophily Effects</h2>
<p>Of course, what makes ergms such a flexible modeling system is that we can fit multiple homophily terms at once. In fact, the list of “covariates” can be as long as you want, with the caveat that the more stuff you condition on, the more restricted (and perhaps nonsensical) is the space of graphs that you are presuming your actual data came from.</p>
<p>Regardless, here’s a model with multiple homophily effects, one for levels and the other for “Department”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>   m4 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges <span class="sc">+</span>  <span class="fu">nodematch</span>(<span class="st">"level"</span>) <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"dept"</span>))</span>
<span id="cb20-2"><a href="#cb20-2"></a>   <span class="fu">summary</span>(m4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodematch("level") + nodematch("dept"))

Maximum Likelihood Results:

                Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges            -1.2682     0.2679      0  -4.734  &lt; 1e-04 ***
nodematch.level   0.8217     0.3127      0   2.628  0.00859 ** 
nodematch.dept    1.0345     0.3458      0   2.991  0.00278 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 261.0  on 207  degrees of freedom
 
AIC: 267  BIC: 277.1  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>Which reveals strong homophily effects for each node-level factor “net” of the other one, suggesting that our graph is likely to have come from a world in which nodes form ties selectively based on <em>both</em> these criteria.</p>
</section>
<section id="homophily-on-a-continuous-attribute" class="level2">
<h2 class="anchored" data-anchor-id="homophily-on-a-continuous-attribute">Homophily on a Continuous Attribute</h2>
<p>Some node attributes like “age” and “tenure” in the Krackhardt’s High-Tech Managers data are continuous. Obviously, we couldn’t condition on matching on each level of a continuous attribute.</p>
<p>In the ergm framework homophily on a continuous attribute is handled using the <code>absdiff</code> term, which computes the absolute difference in the value of the attribute between the two nodes incident to the edge:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>   m5 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges </span>
<span id="cb22-2"><a href="#cb22-2"></a>              <span class="sc">+</span>  <span class="fu">nodematch</span>(<span class="st">"level"</span>) <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"dept"</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>              <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a>              )</span>
<span id="cb22-5"><a href="#cb22-5"></a>   <span class="fu">summary</span>(m5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodematch("level") + nodematch("dept") + 
    absdiff("age"))

Maximum Likelihood Results:

                Estimate Std. Error MCMC % z value Pr(&gt;|z|)   
edges           -0.89316    0.31550      0  -2.831  0.00464 **
nodematch.level  0.85287    0.31692      0   2.691  0.00712 **
nodematch.dept   1.06643    0.35049      0   3.043  0.00234 **
absdiff.age     -0.03972    0.01850      0  -2.147  0.03180 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 256.2  on 206  degrees of freedom
 
AIC: 264.2  BIC: 277.6  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>Which tells us that there is indeed age homophily in this network <span class="math inline">\(\theta_{agediff} = -0.04, p &lt; 0.05\)</span>. Note that here a <em>negative</em> effect indicates a <em>smaller</em> age difference in the tie, which indicates homophily. A positive effect in the <code>absdiff</code> term would indicate <em>heterophily</em> on the continuous attribute.</p>
</section>
<section id="activity-differences-based-on-a-continuous-factor" class="level2">
<h2 class="anchored" data-anchor-id="activity-differences-based-on-a-continuous-factor">Activity Differences Based on a Continuous Factor</h2>
<p>Of course, just like before, we may want to check that we are not mistaking homophily, with the tendency of people in certain age groups to form more ties in general (e.g., an age/degree correlation in the network).</p>
<p>To fit the analogue of <code>nodefactor</code> for continuous attributes we use <code>nodecov</code>, which conditions on the <em>sum</em> of the values a given attribute for the two nodes incident to the edge:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>   m6 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges </span>
<span id="cb24-2"><a href="#cb24-2"></a>              <span class="sc">+</span>  <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"level"</span>) </span>
<span id="cb24-3"><a href="#cb24-3"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"dept"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>)</span>
<span id="cb24-4"><a href="#cb24-4"></a>              )</span>
<span id="cb24-5"><a href="#cb24-5"></a>   <span class="fu">summary</span>(m6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodecov("age") + nodematch("level") + 
    nodematch("dept") + absdiff("age"))

Maximum Likelihood Results:

                Estimate Std. Error MCMC % z value Pr(&gt;|z|)   
edges           -0.10503    1.11891      0  -0.094  0.92521   
nodecov.age     -0.01104    0.01511      0  -0.731  0.46496   
nodematch.level  0.81527    0.32107      0   2.539  0.01111 * 
nodematch.dept   1.07818    0.35134      0   3.069  0.00215 **
absdiff.age     -0.02951    0.02312      0  -1.276  0.20181   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 255.6  on 205  degrees of freedom
 
AIC: 265.6  BIC: 282.4  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>Like before, after adjusting for the age/degree correlation, there does not seem to be a statistically significant age homophily effect (<span class="math inline">\(p = 0.20\)</span>).</p>
<p>Finally, here’s a model including homophily effects for all four node attributes (two categorical and two continuous) in the Krackhardt High-Tech Managers data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>   m7 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges </span>
<span id="cb26-2"><a href="#cb26-2"></a>              <span class="sc">+</span>  <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"tenure"</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"level"</span>) <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"dept"</span>)  </span>
<span id="cb26-4"><a href="#cb26-4"></a>              <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"tenure"</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a>              )</span>
<span id="cb26-6"><a href="#cb26-6"></a>   <span class="fu">summary</span>(m7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodecov("age") + nodecov("tenure") + 
    nodematch("level") + nodematch("dept") + absdiff("age") + 
    absdiff("tenure"))

Maximum Likelihood Results:

                Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges            0.39296    1.21536      0   0.323 0.746444    
nodecov.age     -0.04671    0.01858      0  -2.514 0.011954 *  
nodecov.tenure   0.07830    0.02116      0   3.701 0.000215 ***
nodematch.level  1.25596    0.35743      0   3.514 0.000442 ***
nodematch.dept   1.63590    0.41072      0   3.983  &lt; 1e-04 ***
absdiff.age     -0.03375    0.02681      0  -1.259 0.208042    
absdiff.tenure   0.01060    0.02936      0   0.361 0.718209    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 236.4  on 203  degrees of freedom
 
AIC: 250.4  BIC: 273.9  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>Note that this model also conditions on the degree correlation between tenure at the firm and degree. As we can see, the categorical homophily effects due to level and department remain strong, however, there is no evidence for homophily effects based on age and tenure.</p>
<p>Instead, the continuous attributes are correlated with degree, with ties featuring younger people being more likely to be observed (negative age effect on the <code>nodecov</code> term) and ties featuring people with longer tenure (positive tenure effect on the <code>nodecov</code> term) also being more likely to be observed. It makes sense to condition on both age and tenure at the same time, since these are strongly correlated at the individual level (<span class="math inline">\(r=\)</span> 0.48)</p>
</section>
<section id="heterogeneous-homophily-effects" class="level2">
<h2 class="anchored" data-anchor-id="heterogeneous-homophily-effects">Heterogeneous Homophily Effects</h2>
<p>Note that <code>nodematch</code> fits a single term for the homophily on a categorical attribute. For an attribute with just two categories this may not be a problem, since we are just comparing “same” connected dyads to “different” connected dyads.</p>
<p>But consider an attribute like “department” in these data, which has four levels. Fitting a single term means we are constraining the homophily effect to be the same regardless of the levels at which the nodes match. So the effect for 4-4 nodes is the same as the effect for 3-3 nodes, which is the same as the effect for 2-2 nodes and so forth.</p>
<p>We can of course relax this homogeneity restriction and specify <em>separate</em> <code>nodematch</code> effects by levels of the categorical attribute:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>   m8 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges </span>
<span id="cb28-2"><a href="#cb28-2"></a>              <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"tenure"</span>)</span>
<span id="cb28-3"><a href="#cb28-3"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"level"</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)) </span>
<span id="cb28-4"><a href="#cb28-4"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"dept"</span>, <span class="at">diff =</span> <span class="cn">TRUE</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))  </span>
<span id="cb28-5"><a href="#cb28-5"></a>              <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"tenure"</span>) </span>
<span id="cb28-6"><a href="#cb28-6"></a>              )</span>
<span id="cb28-7"><a href="#cb28-7"></a>   <span class="fu">summary</span>(m8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodecov("age") + nodecov("tenure") + 
    nodematch("level", levels = c(2, 3)) + nodematch("dept", 
    diff = TRUE, levels = c(2, 3, 4)) + absdiff("age") + absdiff("tenure"))

Maximum Likelihood Results:

                 Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges             1.03210    1.26058      0   0.819 0.412928    
nodecov.age      -0.05374    0.02055      0  -2.616 0.008909 ** 
nodecov.tenure    0.07958    0.02327      0   3.420 0.000627 ***
nodematch.level   1.15303    0.34606      0   3.332 0.000863 ***
nodematch.dept.1  1.26854    0.74658      0   1.699 0.089294 .  
nodematch.dept.2  1.55826    0.56209      0   2.772 0.005566 ** 
nodematch.dept.3 -0.34708    1.33313      0  -0.260 0.794592    
absdiff.age      -0.03089    0.02671      0  -1.157 0.247476    
absdiff.tenure    0.01397    0.02941      0   0.475 0.634642    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 242.7  on 201  degrees of freedom
 
AIC: 260.7  BIC: 290.8  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>Here we are using connected dyads that match at department = 1 in the data (there’s one node that is coded at zero on this variable, so there cannot be dyads that match at this value) as the reference by specifying the <code>levels</code> argument. We specify we want heterogeneous homophily effects by department by setting the <code>diff</code> argument inside the <code>nodematch</code> term to <code>TRUE</code> (it is <code>FALSE</code> by default).</p>
<p>As we can see, we can observe heterogeneous homophily effects on the department attribute in these data. Connected dyads matching on department at levels 2 and 3 are responsible for most of the positive homophily effects. For dyads that match at level 4 of department, there is no homophily (<span class="math inline">\(\theta_{dept4-4} = - 0.35, p = 0.80\)</span>).</p>
</section>
<section id="looking-at-combinations-of-ties-featuring-an-attribute" class="level2">
<h2 class="anchored" data-anchor-id="looking-at-combinations-of-ties-featuring-an-attribute">Looking at combinations of ties featuring an attribute</h2>
<p>In the preceding we looked at terms that condition on <em>homophily</em> or the probability that a given edge in a network drawn at random would feature nodes that <em>match</em> on a given attribute. Sometimes, we may be interested in looking at terms that condition on both matching and not-matching. For this task, we use the <code>ergm</code> term <code>nodemix</code>.</p>
<p>Let’s look at an example. But first let’s switch to a different data set, this time the friendship nomination network from Lazega’s Law Firm data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>   g <span class="ot">&lt;-</span> law_friends</span>
<span id="cb30-2"><a href="#cb30-2"></a>   g <span class="ot">&lt;-</span> <span class="fu">as_undirected</span>(g, <span class="at">mode =</span> <span class="st">"collapse"</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>   n <span class="ot">&lt;-</span> <span class="fu">asNetwork</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now let’s fit an ergm that conditions on homophily and activity effects for four individual level covariates: gender, partner status, age, seniority.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>   m9 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges <span class="sc">+</span> </span>
<span id="cb31-2"><a href="#cb31-2"></a>                  <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"seniority"</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a>                  <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"status"</span>) <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"gender"</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a>                  <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"status"</span>) <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"gender"</span>)</span>
<span id="cb31-5"><a href="#cb31-5"></a>                  <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"seniority"</span>)</span>
<span id="cb31-6"><a href="#cb31-6"></a>              )</span>
<span id="cb31-7"><a href="#cb31-7"></a>   <span class="fu">summary</span>(m9)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + +nodecov("age") + nodecov("seniority") + 
    nodefactor("status") + nodefactor("gender") + nodematch("status") + 
    nodematch("gender") + absdiff("age") + absdiff("seniority"))

Maximum Likelihood Results:

                     Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges               -0.851155   0.524376      0  -1.623 0.104551    
nodecov.age         -0.008933   0.007078      0  -1.262 0.206900    
nodecov.seniority    0.017056   0.008958      0   1.904 0.056905 .  
nodefactor.status.2 -0.406772   0.118871      0  -3.422 0.000622 ***
nodefactor.gender.2  0.193677   0.115764      0   1.673 0.094320 .  
nodematch.status     0.799008   0.147556      0   5.415  &lt; 1e-04 ***
nodematch.gender     0.389504   0.149017      0   2.614 0.008953 ** 
absdiff.age         -0.030883   0.010068      0  -3.068 0.002158 ** 
absdiff.seniority   -0.067122   0.012294      0  -5.460  &lt; 1e-04 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 3445  on 2485  degrees of freedom
 Residual Deviance: 1928  on 2476  degrees of freedom
 
AIC: 1946  BIC: 1999  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>We can see that there are not statistically significant activity effects based on attribute, except for the one premised on status in the firm (although both the positive seniority and gender effects are significant at the <span class="math inline">\(p &lt;0.10\)</span> level. We can also observe predicted homophily effects based on all four characteristics. This looks like a well-fitting useful baseline model.</p>
<p>Let’s now add additional activity and homophily effects <code>law_school</code>. This variable is coded into three categories: (1) Harvard/Yale, (2) Uconn, (3) “Other”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>   m10 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>                  <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"seniority"</span>)</span>
<span id="cb33-3"><a href="#cb33-3"></a>                  <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"status"</span>) <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"gender"</span>)</span>
<span id="cb33-4"><a href="#cb33-4"></a>                  <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"law_school"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a>                  <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"status"</span>) <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"gender"</span>)</span>
<span id="cb33-6"><a href="#cb33-6"></a>                  <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"seniority"</span>)</span>
<span id="cb33-7"><a href="#cb33-7"></a>                  <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"law_school"</span>)</span>
<span id="cb33-8"><a href="#cb33-8"></a>              )</span>
<span id="cb33-9"><a href="#cb33-9"></a>   <span class="fu">summary</span>(m10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + +nodecov("age") + nodecov("seniority") + 
    nodefactor("status") + nodefactor("gender") + nodefactor("law_school", 
    base = 3) + nodematch("status") + nodematch("gender") + absdiff("age") + 
    absdiff("seniority") + nodematch("law_school"))

Maximum Likelihood Results:

                         Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges                   -1.275735   0.550528      0  -2.317 0.020488 *  
nodecov.age             -0.006860   0.007370      0  -0.931 0.351919    
nodecov.seniority        0.015054   0.009091      0   1.656 0.097734 .  
nodefactor.status.2     -0.429909   0.120257      0  -3.575 0.000350 ***
nodefactor.gender.2      0.134855   0.118160      0   1.141 0.253747    
nodefactor.law_school.1  0.091510   0.128525      0   0.712 0.476464    
nodefactor.law_school.2  0.319710   0.094629      0   3.379 0.000729 ***
nodematch.status         0.802762   0.148891      0   5.392  &lt; 1e-04 ***
nodematch.gender         0.383468   0.149576      0   2.564 0.010356 *  
absdiff.age             -0.030985   0.010123      0  -3.061 0.002207 ** 
absdiff.seniority       -0.066486   0.012437      0  -5.346  &lt; 1e-04 ***
nodematch.law_school     0.109033   0.122245      0   0.892 0.372436    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 3445  on 2485  degrees of freedom
 Residual Deviance: 1915  on 2473  degrees of freedom
 
AIC: 1939  BIC: 2009  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>This model shows that Uconn graduates are more popular in the friendship network (they form more ties), compared to graduates from “other” schools, but that there doesn’t seem to be homophily based on this factor.</p>
</section>
<section id="homophily-via-combination-of-attributes" class="level2">
<h2 class="anchored" data-anchor-id="homophily-via-combination-of-attributes">Homophily via Combination of Attributes</h2>
<p>Sometimes we may suspect that homophily happens via a <em>combination</em> of attributes (e.g., gender and status). We can specify such effects using the <code>nodemix</code> term as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>   m11 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>                  <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"seniority"</span>)</span>
<span id="cb35-3"><a href="#cb35-3"></a>                  <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"status"</span>) <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"gender"</span>)</span>
<span id="cb35-4"><a href="#cb35-4"></a>                  <span class="sc">+</span> <span class="fu">nodefactor</span>(<span class="st">"law_school"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb35-5"><a href="#cb35-5"></a>                  <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"seniority"</span>)</span>
<span id="cb35-6"><a href="#cb35-6"></a>                  <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"law_school"</span>)</span>
<span id="cb35-7"><a href="#cb35-7"></a>                  <span class="sc">+</span> <span class="fu">nodemix</span>(<span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"status"</span>), <span class="at">levels =</span> <span class="cn">TRUE</span>, <span class="at">levels2 =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb35-8"><a href="#cb35-8"></a>              )</span>
<span id="cb35-9"><a href="#cb35-9"></a>   <span class="fu">summary</span>(m11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + +nodecov("age") + nodecov("seniority") + 
    nodefactor("status") + nodefactor("gender") + nodefactor("law_school", 
    base = 3) + absdiff("age") + absdiff("seniority") + nodematch("law_school") + 
    nodemix(c("gender", "status"), levels = TRUE, levels2 = c(1:6)))

Maximum Likelihood Results:

                           Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges                     -2.225120   0.715918      0  -3.108 0.001883 ** 
nodecov.age               -0.006030   0.007508      0  -0.803 0.421886    
nodecov.seniority          0.017111   0.009211      0   1.858 0.063210 .  
nodefactor.status.2        0.132407   0.239020      0   0.554 0.579607    
nodefactor.gender.2        0.554151   0.238303      0   2.325 0.020050 *  
nodefactor.law_school.1    0.080613   0.128892      0   0.625 0.531689    
nodefactor.law_school.2    0.326575   0.095087      0   3.434 0.000594 ***
absdiff.age               -0.029508   0.010222      0  -2.887 0.003891 ** 
absdiff.seniority         -0.069504   0.012543      0  -5.541  &lt; 1e-04 ***
nodematch.law_school       0.110916   0.122475      0   0.906 0.365138    
mix.gender.status.1.1.1.1  1.940435   0.472391      0   4.108  &lt; 1e-04 ***
mix.gender.status.1.1.1.2  0.645250   0.358610      0   1.799 0.071970 .  
mix.gender.status.1.2.1.2  1.134592   0.380036      0   2.985 0.002831 ** 
mix.gender.status.1.1.2.1  1.462671   0.443169      0   3.300 0.000965 ***
mix.gender.status.1.2.2.1 -0.869626   0.622416      0  -1.397 0.162360    
mix.gender.status.2.1.2.1  2.127482   1.314879      0   1.618 0.105661    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 3445  on 2485  degrees of freedom
 Residual Deviance: 1908  on 2469  degrees of freedom
 
AIC: 1940  BIC: 2033  (Smaller is better. MC Std. Err. = 0)</code></pre>
</div>
</div>
<p>Here we use low status homogeneous dyads (regardless of gender mix) as the comparison category. The results show that compared to those dyads, high-status homogeneous, all men dyads are more prevalent, as gender-mixed dyads where the man is higher status. We also find a preponderance of all-men, status heterogeneous dyads.</p>
</section>
<section id="checking-for-model-fit" class="level2">
<h2 class="anchored" data-anchor-id="checking-for-model-fit">Checking for Model Fit</h2>
<p>In ergms we can always check for model fit using standard statistics they share with general linear models, like the model deviance, BIC, AIC and so forth. These are particularly useful when trying to decide between nested models.</p>
<p>However, we can also use the fact that each ergm specifies a <em>probability distribution</em> across a graph ensemble consistent with the estimated parameters to see whether the specification we decided on actually produces graphs with global (network level) characteristics that fall within a plausible range.</p>
<p>That is, even though network level factors are not directly specified in the model, a good model should be able to reproduce them via the local tie generating processes we specified.</p>
<p>When an ergm specification does not do this, and instead produces graphs within a narrow or weird range of values—e.g., for basic network statistics like the degree distribution, the geodesic distance distribution, or basic counts of key motifs like triangles and number of shared partners (a technical issue known as “degeneracy” in the ergm framework)—then that is a signal we need to change something in our specification.</p>
<p>In the <code>ergm</code> package we can check for goodness of fit based on the ability to match global network characteristics using the <code>gof</code> function. The function takes a <code>ergm</code> model object as input along with an optional argument called <code>GOF</code> specifying what simulated global network property across the implied graph ensemble we want to compare to our observed values. The main ones include the degree distribution, the distribution of edge-wise shared partners (common neighbors of connected dyads), and the geodesic distance distribution (number of dyads separated by shortest parths of a given length).</p>
<p>Let’s use <code>m8</code> above which was the attribute-driven model with heterogeneous homophily effects for department we fit to the Krackhardt High Tech Managers data. Let’s say, we wanted to see whether our model was successful in reproducing the distribution of activity (degree) across nodes. In that case, we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>   <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb37-2"><a href="#cb37-2"></a>   gof.m8 <span class="ot">&lt;-</span> <span class="fu">gof</span>(m8, <span class="at">GOF =</span> <span class="sc">~</span> degree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we asked <code>gof</code> to create a graph ensemble of one hundred graphs (the default) and look at the degree distribution in each, recording how many times a node with a given degree is observed in each graph.</p>
<p>To see the result we can check out the following object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>   gof.m8<span class="sc">$</span>pval.deg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         obs min mean max MC p-value
degree0    0   0 0.08   1       1.00
degree1    0   0 0.36   3       1.00
degree2    1   0 0.45   2       0.78
degree3    1   0 1.03   4       1.00
degree4    1   0 1.32   5       1.00
degree5    3   0 1.93   5       0.68
degree6    4   0 2.37   8       0.44
degree7    2   0 2.68   7       1.00
degree8    2   0 2.71   8       1.00
degree9    2   0 2.66   8       1.00
degree10   3   0 1.97   6       0.56
degree11   0   0 1.60   5       0.46
degree12   0   0 1.05   4       0.64
degree13   0   0 0.48   3       1.00
degree14   1   0 0.18   1       0.36
degree15   0   0 0.09   2       1.00
degree16   0   0 0.03   1       1.00
degree17   0   0 0.01   1       1.00
degree18   1   0 0.00   0       0.00
degree19   0   0 0.00   0       1.00
degree20   0   0 0.00   0       1.00</code></pre>
</div>
</div>
<p>The way to read the table is as follows: Under the column “obs” is the values of degree in the data (observed), then the other columns contain the range (min and max) and the mean of the each value of degree in the graph ensemble implied by the model.</p>
<p>The p-value is a test that the observed value is significantly different from the <em>mean</em> of the graph ensemble. Note that in a good fitting model, <em>the mean of the ensemble implied by the model</em> so we want <span class="math inline">\(p &gt; 0.05\)</span> for each row in the table as this indicates a <em>good fitting model</em>. We can see that this is indeed the case for every value except the last outlier one (<span class="math inline">\(k = 18\)</span>), the simulations show this never happening (max = 0), so it is outside of the range of the observed value of one (<span class="math inline">\(p = 0.00\)</span>).</p>
<p>Overall, however, the model does a good job of reproducing a distribution of degrees in the ensemble consistent with the observed data. If we wanted to see it in a plot, we would just type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>   <span class="fu">plot</span>(gof.m8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="handout10_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="handout10_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this box plot, the ensemble mean is the blue diamond, the gray box is the interquartile (25th to 75th percentile) range, the black horizontal line in the gray box is the ensemble median, and the black connected line plot is the observed values.</p>
<p>What we would like to see in a well-fitting model is a black line that goes through the gray box and is not outside them, which is generally the case here for most of the observed range except for the very large values.</p>
</section>
<section id="conditioning-on-degree-and-shared-partners" class="level2">
<h2 class="anchored" data-anchor-id="conditioning-on-degree-and-shared-partners">Conditioning on Degree and Shared Partners</h2>
<p>Note that all the models estimated earlier only adjust for the edges parameter as a structural effect. In this sense, they are using the Erdos-Renyi model as the structural baseline.</p>
<p>As we saw with the edge swapping models, it is probably better to use more sophisticated null models than the Erdos-Renyi one. For instance, models that condition on degree heterogeneity in some way, or that also account for transitivity (e.g., triangle) effects (e.g., the tendency of dyads sharing common partners to be connected).</p>
<p>In an ergm context, we could condition on the degree distribution by adding a separate parameter for each observed degree, or adding a <code>triangle</code> term. These models are computationally intensive, and often fail to converge (for obscure technical reasons).</p>
<p>A better approach is to fit both degree heterogeneity and transitivity effect using a family of <strong>geometrically weighted decay parameter</strong> terms. The idea is to fit the distribution of a given quantity (e.g., degree, number of shared partners per dyad) by fitting a curve with a term that decays as either the degree or the number of shared partners increases, thus giving more weight to lower degrees and the first or second shared partner as compared to the third, fourth, fifth, and so forth.</p>
<p>These <code>gw</code> terms are less computationally intensive and use a single parameter to fit both the degree distribution—using the <code>gwdegree</code> term—and the (dyad or edge)wise shared partner distribution—using the <code>gwdsp</code> and <code>gwesp</code> terms (respectively).</p>
<p>Let’s see how the <code>gw</code> ergm terms work, going back to Krackhardt’s High Tech Managers data. Here’s a model looking at activity and homophily effects conditioning on the degree distribution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>   g <span class="ot">&lt;-</span> ht_friends</span>
<span id="cb41-2"><a href="#cb41-2"></a>   g <span class="ot">&lt;-</span> <span class="fu">as_undirected</span>(g, <span class="at">mode =</span> <span class="st">"collapse"</span>)</span>
<span id="cb41-3"><a href="#cb41-3"></a>   n <span class="ot">&lt;-</span> <span class="fu">asNetwork</span>(g)</span>
<span id="cb41-4"><a href="#cb41-4"></a>   m12 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges </span>
<span id="cb41-5"><a href="#cb41-5"></a>              <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"tenure"</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"level"</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)) </span>
<span id="cb41-7"><a href="#cb41-7"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"dept"</span>, <span class="at">diff =</span> <span class="cn">TRUE</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))  </span>
<span id="cb41-8"><a href="#cb41-8"></a>              <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"tenure"</span>) </span>
<span id="cb41-9"><a href="#cb41-9"></a>              <span class="sc">+</span> <span class="fu">gwdegree</span>(<span class="at">decay =</span> <span class="fl">0.25</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-10"><a href="#cb41-10"></a>              )</span>
<span id="cb41-11"><a href="#cb41-11"></a>   <span class="fu">summary</span>(m12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodecov("age") + nodecov("tenure") + 
    nodematch("level", levels = c(2, 3)) + nodematch("dept", 
    diff = TRUE, levels = c(2, 3, 4)) + absdiff("age") + absdiff("tenure") + 
    gwdegree(decay = 0.25, fixed = TRUE))

Monte Carlo Maximum Likelihood Results:

                 Estimate Std. Error MCMC % z value Pr(&gt;|z|)   
edges             1.56101    1.53828      0   1.015  0.31021   
nodecov.age      -0.06362    0.02524      0  -2.520  0.01173 * 
nodecov.tenure    0.08518    0.02593      0   3.285  0.00102 **
nodematch.level   1.15615    0.36159      0   3.197  0.00139 **
nodematch.dept.1  1.39805    0.78609      0   1.778  0.07532 . 
nodematch.dept.2  1.62179    0.58450      0   2.775  0.00553 **
nodematch.dept.3 -0.50239    1.36220      0  -0.369  0.71227   
absdiff.age      -0.03298    0.02463      0  -1.339  0.18058   
absdiff.tenure    0.01995    0.03107      0   0.642  0.52079   
gwdeg.fixed.0.25  7.55080   15.28561      0   0.494  0.62132   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 242.1  on 200  degrees of freedom
 
AIC: 262.1  BIC: 295.6  (Smaller is better. MC Std. Err. = 0.08229)</code></pre>
</div>
</div>
<p>Note that our homophily estimates are still significant, even after accounting for heterogeneity in the degree distribution, the estimate of corresponding to the <code>gwdegree</code> term is not significant, suggesting that our activity and homophily attributes do a good job of fitting the empirical degree distribution (which we knew form our goodness of fit tests).</p>
<p>Now, here’s a model that conditions on the tendency for dyads who share common partners to themselves be connected:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>   g <span class="ot">&lt;-</span> ht_friends</span>
<span id="cb43-2"><a href="#cb43-2"></a>   g <span class="ot">&lt;-</span> <span class="fu">as_undirected</span>(g, <span class="at">mode =</span> <span class="st">"collapse"</span>)</span>
<span id="cb43-3"><a href="#cb43-3"></a>   n <span class="ot">&lt;-</span> <span class="fu">asNetwork</span>(g)</span>
<span id="cb43-4"><a href="#cb43-4"></a>   m12 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges </span>
<span id="cb43-5"><a href="#cb43-5"></a>              <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"tenure"</span>)</span>
<span id="cb43-6"><a href="#cb43-6"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"level"</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)) </span>
<span id="cb43-7"><a href="#cb43-7"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"dept"</span>, <span class="at">diff =</span> <span class="cn">TRUE</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))  </span>
<span id="cb43-8"><a href="#cb43-8"></a>              <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"tenure"</span>) </span>
<span id="cb43-9"><a href="#cb43-9"></a>              <span class="sc">+</span> <span class="fu">gwdsp</span>(<span class="at">decay =</span> <span class="fl">0.25</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-10"><a href="#cb43-10"></a>              )</span>
<span id="cb43-11"><a href="#cb43-11"></a>   <span class="fu">summary</span>(m12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodecov("age") + nodecov("tenure") + 
    nodematch("level", levels = c(2, 3)) + nodematch("dept", 
    diff = TRUE, levels = c(2, 3, 4)) + absdiff("age") + absdiff("tenure") + 
    gwdsp(decay = 0.25, fixed = TRUE))

Monte Carlo Maximum Likelihood Results:

                 Estimate Std. Error MCMC % z value Pr(&gt;|z|)   
edges             1.16726    1.40838      0   0.829  0.40722   
nodecov.age      -0.06852    0.02288      0  -2.995  0.00274 **
nodecov.tenure    0.08571    0.02619      0   3.273  0.00107 **
nodematch.level   1.26334    0.40822      0   3.095  0.00197 **
nodematch.dept.1  1.40475    0.76587      0   1.834  0.06663 . 
nodematch.dept.2  1.53716    0.58401      0   2.632  0.00849 **
nodematch.dept.3 -0.67235    1.36362      0  -0.493  0.62197   
absdiff.age      -0.03087    0.02743      0  -1.125  0.26039   
absdiff.tenure    0.01625    0.03146      0   0.516  0.60552   
gwdsp.fixed.0.25  0.55992    0.23784      0   2.354  0.01856 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 235.4  on 200  degrees of freedom
 
AIC: 255.4  BIC: 288.9  (Smaller is better. MC Std. Err. = 0.1518)</code></pre>
</div>
</div>
<p>In this model, we find a statistically significant <span class="math inline">\(\theta\)</span> estimate for the <strong>geometrically weighted dyadwise shared partners</strong> effect (with decay parameter <span class="math inline">\(\gamma = 0.25\)</span>), suggesting that this network is likely drawn from a distribution of graphs where pairs of nodes mutually connected to a third are also more likely to be connected themselves (<span class="math inline">\(p &lt; 0.05\)</span>).</p>
<p>However, even after adjusting for this structural tendency our homophily effects are still statistically significant, suggesting that they are not the spurious byproduct of transitivity in friendship ties.</p>
<p>Finally, we can also adjust for the tendency of connected dyads to share multiple friends (e.g., connected dyads being embedded on one or more triangles), also known as the <strong>Simmelian Tie</strong> effect, also known as the <strong>geometrically weighted edgewise shared partners</strong> effect:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>   g <span class="ot">&lt;-</span> ht_friends</span>
<span id="cb45-2"><a href="#cb45-2"></a>   g <span class="ot">&lt;-</span> <span class="fu">as_undirected</span>(g, <span class="at">mode =</span> <span class="st">"collapse"</span>)</span>
<span id="cb45-3"><a href="#cb45-3"></a>   n <span class="ot">&lt;-</span> <span class="fu">asNetwork</span>(g)</span>
<span id="cb45-4"><a href="#cb45-4"></a>   m13 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(n <span class="sc">~</span> edges </span>
<span id="cb45-5"><a href="#cb45-5"></a>              <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">nodecov</span>(<span class="st">"tenure"</span>)</span>
<span id="cb45-6"><a href="#cb45-6"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"level"</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)) </span>
<span id="cb45-7"><a href="#cb45-7"></a>              <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"dept"</span>, <span class="at">diff =</span> <span class="cn">TRUE</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))  </span>
<span id="cb45-8"><a href="#cb45-8"></a>              <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"age"</span>) <span class="sc">+</span> <span class="fu">absdiff</span>(<span class="st">"tenure"</span>) </span>
<span id="cb45-9"><a href="#cb45-9"></a>              <span class="sc">+</span> <span class="fu">gwdsp</span>(<span class="at">decay =</span> <span class="fl">0.25</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-10"><a href="#cb45-10"></a>              <span class="sc">+</span> <span class="fu">gwesp</span>(<span class="at">decay =</span> <span class="fl">0.25</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-11"><a href="#cb45-11"></a>              )</span>
<span id="cb45-12"><a href="#cb45-12"></a>   <span class="fu">summary</span>(m13)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = n ~ edges + nodecov("age") + nodecov("tenure") + 
    nodematch("level", levels = c(2, 3)) + nodematch("dept", 
    diff = TRUE, levels = c(2, 3, 4)) + absdiff("age") + absdiff("tenure") + 
    gwdsp(decay = 0.25, fixed = TRUE) + gwesp(decay = 0.25, fixed = TRUE))

Monte Carlo Maximum Likelihood Results:

                 Estimate Std. Error MCMC % z value Pr(&gt;|z|)   
edges            -0.75620    1.99545      0  -0.379  0.70471   
nodecov.age      -0.06005    0.02130      0  -2.820  0.00480 **
nodecov.tenure    0.07811    0.02526      0   3.092  0.00199 **
nodematch.level   1.20285    0.39791      0   3.023  0.00250 **
nodematch.dept.1  1.32797    0.78746      0   1.686  0.09172 . 
nodematch.dept.2  1.39367    0.55827      0   2.496  0.01255 * 
nodematch.dept.3 -0.71792    1.32015      0  -0.544  0.58657   
absdiff.age      -0.03118    0.02791      0  -1.117  0.26396   
absdiff.tenure    0.01854    0.03028      0   0.612  0.54038   
gwdsp.fixed.0.25  0.40011    0.23478      0   1.704  0.08835 . 
gwesp.fixed.0.25  1.14136    1.06525      0   1.071  0.28397   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 291.1  on 210  degrees of freedom
 Residual Deviance: 233.1  on 199  degrees of freedom
 
AIC: 255.1  BIC: 292  (Smaller is better. MC Std. Err. = 0.2465)</code></pre>
</div>
</div>
<p>Which shows that our results are also robust to this structural tendency, although the transitivity effect is weakened a bit (<span class="math inline">\(p &lt; 0.10\)</span>) when adjusting for statistical prevalence of Simmelian ties.</p>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-pattison_robins12" class="csl-entry" role="doc-biblioentry">
Pattison, Philippa, and Garry Robins. 2002. <span>“Neighborhood-Based Models for Social Networks.”</span> <em>Sociological Methodology</em> 32 (1): 301–37.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The denominator (<span class="math inline">\(\kappa(\theta)\)</span>) is a normalizing constant required for the expression to result in a proper probability distribution and thus is of no substantive significance.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>