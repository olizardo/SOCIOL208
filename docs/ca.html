<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SOCIOL 208 - Correspondence Analysis (CA) of Two-Mode Networks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="SOCIOL 208 - Correspondence Analysis (CA) of Two-Mode Networks">
<meta property="og:description" content="Correspondence Analysis (CA) a relatively simple way to analyze and visualize two-mode data. However, there are a few additional computational details to discuss.">
<meta property="og:site-name" content="SOCIOL 208">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Correspondence Analysis (CA) of Two-Mode Networks</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SOCIOL 208</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">208A</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-208A.html" class="sidebar-item-text sidebar-link">208A Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule-208A-F24.html" class="sidebar-item-text sidebar-link">SOCIOL 208A Reading Schedule (Fall 2024)</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Handouts</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout1.html" class="sidebar-item-text sidebar-link">Basic Network Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inoutdegdist.html" class="sidebar-item-text sidebar-link">Graph Degree Metrics in Directed Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout2.html" class="sidebar-item-text sidebar-link">Centrality</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cube.html" class="sidebar-item-text sidebar-link">The Cube</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout3.html" class="sidebar-item-text sidebar-link">Status and Prestige</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout4.html" class="sidebar-item-text sidebar-link">Role Equivalence and Structural Similarity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout5.html" class="sidebar-item-text sidebar-link">Vertex Similarity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./blondel.html" class="sidebar-item-text sidebar-link">Role Similarity Across Graphs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout6.html" class="sidebar-item-text sidebar-link">Community Structure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ahn.html" class="sidebar-item-text sidebar-link">Assigning Nodes to Multiple Communities</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handout7.html" class="sidebar-item-text sidebar-link">Analyzing Two-Mode Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ca.html" class="sidebar-item-text sidebar-link active">Correspondence Analysis (CA) of Two-Mode Networks</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">208B</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-208B.html" class="sidebar-item-text sidebar-link">208B Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule-208B-S24.html" class="sidebar-item-text sidebar-link">SOCIOL 208B Reading Schedule (Spring 2024)</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-eigendecomposition-of-a-square-matrix" id="toc-the-eigendecomposition-of-a-square-matrix" class="nav-link active" data-scroll-target="#the-eigendecomposition-of-a-square-matrix">The Eigendecomposition of a Square Matrix</a></li>
  <li><a href="#obtaining-the-matrices-we-need" id="toc-obtaining-the-matrices-we-need" class="nav-link" data-scroll-target="#obtaining-the-matrices-we-need">Obtaining the Matrices We Need</a></li>
  <li><a href="#performing-ca" id="toc-performing-ca" class="nav-link" data-scroll-target="#performing-ca">Performing CA</a></li>
  <li><a href="#the-duality-of-ca-scores-between-persons-and-groups" id="toc-the-duality-of-ca-scores-between-persons-and-groups" class="nav-link" data-scroll-target="#the-duality-of-ca-scores-between-persons-and-groups">The Duality of CA Scores Between Persons and Groups</a></li>
  <li><a href="#visualizing-two-mode-networks-using-ca" id="toc-visualizing-two-mode-networks-using-ca" class="nav-link" data-scroll-target="#visualizing-two-mode-networks-using-ca">Visualizing Two-Mode Networks Using CA</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/olizardo/SOCIOL208/blob/main/ca.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Correspondence Analysis (CA) of Two-Mode Networks</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Correspondence Analysis</strong> (CA) a relatively simple way to analyze and visualize two-mode data. However, there are a few additional computational details to discuss.</p>
<section id="the-eigendecomposition-of-a-square-matrix" class="level2">
<h2 class="anchored" data-anchor-id="the-eigendecomposition-of-a-square-matrix">The Eigendecomposition of a Square Matrix</h2>
<p>First, let us review the idea of an <strong>eigendecomposition</strong> of a square matrix. Let’s say we have the following matrix <span class="math inline">\(\mathbf{B}\)</span> of dimensions <span class="math inline">\(3 \times 3\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>   <span class="fu">set.seed</span>(<span class="dv">567</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>   B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">round</span>(<span class="fu">runif</span>(<span class="dv">9</span>), <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>   B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,] 0.74 0.49 0.07
[2,] 0.88 0.26 0.51
[3,] 0.63 0.24 0.59</code></pre>
</div>
</div>
<p>Most matrices like this can be decomposed into two other matrices <span class="math inline">\(\mathbf{U}\)</span> and <span class="math inline">\(\mathbf{\lambda}\)</span>, such that the following matrix multiplication equation is true:</p>
<p><span class="math display">\[
\mathbf{B} = \mathbf{U}\mathbf{\lambda}\mathbf{U}^{-1}
\]</span></p>
<p>Both <span class="math inline">\(\mathbf{U}\)</span> and <span class="math inline">\(\mathbf{\lambda}\)</span> are of the same dimensions as the original, with <span class="math inline">\(\mathbf{U}\)</span> having numbers in each cell and <span class="math inline">\(\mathbf{\lambda}\)</span> being a matrix with values along the diagonals and zeros everywhere else.</p>
<p>The column values of <span class="math inline">\(\mathbf{U}\)</span> are called the <strong>eigenvectors</strong> of <span class="math inline">\(\mathbf{B}\)</span> and the diagonal values of <span class="math inline">\(\mathbf{\lambda}\)</span> are called the <strong>eigenvalues</strong> of <span class="math inline">\(\mathbf{B}\)</span>.</p>
<p>In <code>R</code> you can find the values that yield the eigendecomposition of any square matrix (if one exists) using the function <code>eigen</code>.</p>
<p>So in our case this would be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>   eig.res <span class="ot">&lt;-</span> <span class="fu">eigen</span>(B)</span>
<span id="cb3-2"><a href="#cb3-2"></a>   eig.res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1]  1.4256541  0.3195604 -0.1552145

$vectors
           [,1]       [,2]       [,3]
[1,] -0.5148954 -0.4669390  0.4838633
[2,] -0.6388257  0.2808667 -0.8653808
[3,] -0.5716507  0.8384997 -0.1303551</code></pre>
</div>
</div>
<p>The function <code>eigen</code> returns a list with two components, one called <code>values</code> are the diagonal values of <span class="math inline">\(\mathbf{\lambda}\)</span>, and the other one called <code>vectors</code> is the eigenvector matrix <span class="math inline">\(\mathbf{U}\)</span>.</p>
<p>We can check that these two elements can help us reconstruct the original matrix as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>   lambda <span class="ot">&lt;-</span> <span class="fu">diag</span>(eig.res<span class="sc">$</span>values)</span>
<span id="cb5-2"><a href="#cb5-2"></a>   U <span class="ot">&lt;-</span> eig.res<span class="sc">$</span>vectors</span>
<span id="cb5-3"><a href="#cb5-3"></a>   B.rec <span class="ot">&lt;-</span> U <span class="sc">%*%</span> lambda <span class="sc">%*%</span> <span class="fu">solve</span>(U)</span>
<span id="cb5-4"><a href="#cb5-4"></a>   B.rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,] 0.74 0.49 0.07
[2,] 0.88 0.26 0.51
[3,] 0.63 0.24 0.59</code></pre>
</div>
</div>
<p>Which are indeed the original values of <span class="math inline">\(\mathbf{B}\)</span>!</p>
<p>Now, the idea is that we can perform this eigendecomposition with any matrix, including a network adjacency matrix or a proximity matrix derived from it. In fact, we have already done that in part many times before, because the reflective status game is a way to compute the first column (leading eigenvector) of the <span class="math inline">\(\mathbf{U}\)</span> matrix for any proximity or adjacency matrix you feed into it.</p>
<p>The more important thing is that, once you have the eigendecomposition of a matrix, and the full set of eigenvectors stored in <span class="math inline">\(\mathbf{U}\)</span>, the first few columns of <span class="math inline">\(\mathbf{U}\)</span>, gives us the best <em>low dimensional approximation</em> of the original matrix.</p>
</section>
<section id="obtaining-the-matrices-we-need" class="level2">
<h2 class="anchored" data-anchor-id="obtaining-the-matrices-we-need">Obtaining the Matrices We Need</h2>
<p>CA boils down to the eigendecomposition of a suitable matrix, derived from the original affiliation (bi-adjacency) matrix of a two-mode network.</p>
<p>So which matrix should be use for CA? Let’s find out:</p>
<p>First we need to create <strong>row stochastic</strong> versions of the affiliation matrix and its transpose <span class="math inline">\(\mathbf{A}\)</span> and <span class="math inline">\(\mathbf{A}^T\)</span>. Recall that a matrix is row stochastic if their rows sum to one.</p>
<p>For the people, we can do this by taking the original affiliation matrix, and pre-multiplying it by a <strong>diagonal square matrix</strong> <span class="math inline">\(\mathbf{D}_P^{-1}\)</span> of dimensions <span class="math inline">\(M \times M\)</span> containing the <em>inverse</em> of the degrees of each person in the affiliation network along the diagonals and zeros everywhere else, yielding the row-stochastic matrix <span class="math inline">\(\mathbf{P}_P\)</span> of dimensions <span class="math inline">\(M \times N\)</span>:</p>
<p><span class="math display">\[
\mathbf{P}_P = \mathbf{D}_P^{-1}\mathbf{A}
\]</span></p>
<p>And we can do the same with the groups, except that we pre-multiply the <em>transpose</em> of the original affiliation matrix by <span class="math inline">\(\mathbf{D}_G^{-1}\)</span> which is an <span class="math inline">\(N \times N\)</span> matrix containing the inverse of the size of each group along the diagonals and zero everywhere else, this yields the matrix <span class="math inline">\(\mathbf{P}_G\)</span> of dimensions <span class="math inline">\(N \times M\)</span>:</p>
<p><span class="math display">\[
\mathbf{P}_G = \mathbf{D}_G^{-1}\mathbf{A}^T
\]</span></p>
<p>In <code>R</code> can compute <span class="math inline">\(\mathbf{P}_P\)</span> and <span class="math inline">\(\mathbf{P}_G\)</span>, using the classic Southern Women two-mode data, as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>   <span class="fu">library</span>(igraph)</span>
<span id="cb7-2"><a href="#cb7-2"></a>   <span class="fu">library</span>(networkdata)</span>
<span id="cb7-3"><a href="#cb7-3"></a>   g <span class="ot">&lt;-</span> southern_women <span class="co">#southern women data</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>   A <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">as_biadjacency_matrix</span>(g)) <span class="co">#bi-adjacency matrix</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>   D.p <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">rowSums</span>(A)) <span class="co">#inverse of degree matrix of persons</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>   P.p <span class="ot">&lt;-</span> D.p <span class="sc">%*%</span> A</span>
<span id="cb7-7"><a href="#cb7-7"></a>   <span class="fu">rownames</span>(P.p) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(A) </span>
<span id="cb7-8"><a href="#cb7-8"></a>   D.g <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">colSums</span>(A)) <span class="co">#inverse of degree matrix of groups</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>   P.g <span class="ot">&lt;-</span> D.g <span class="sc">%*%</span> <span class="fu">t</span>(A)</span>
<span id="cb7-10"><a href="#cb7-10"></a>   <span class="fu">rownames</span>(P.g) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we can check that both <span class="math inline">\(\mathbf{P}_P\)</span> and <span class="math inline">\(\mathbf{P}_G\)</span> are indeed row stochastic:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>   <span class="fu">rowSums</span>(P.p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   EVELYN     LAURA   THERESA    BRENDA CHARLOTTE   FRANCES   ELEANOR     PEARL 
        1         1         1         1         1         1         1         1 
     RUTH     VERNE     MYRNA KATHERINE    SYLVIA      NORA     HELEN   DOROTHY 
        1         1         1         1         1         1         1         1 
   OLIVIA     FLORA 
        1         1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>   <span class="fu">rowSums</span>(P.g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 6/27   3/2  4/12  9/26  2/25  5/19  3/15  9/16   4/8  6/10  2/23   4/7 11/21 
    1     1     1     1     1     1     1     1     1     1     1     1     1 
  8/3 
    1 </code></pre>
</div>
</div>
<p>And that they are of the predicted dimensions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>   <span class="fu">dim</span>(P.p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>   <span class="fu">dim</span>(P.g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14 18</code></pre>
</div>
</div>
<p>Great! Now, we can obtain the <em>degree-normalized projections</em> for people by multiplying <span class="math inline">\(\mathbf{P}_P\)</span> times <span class="math inline">\(\mathbf{P}_G\)</span>:</p>
<p><span class="math display">\[
\mathbf{P}_{PP} = \mathbf{P}_P\mathbf{P}_G
\]</span></p>
<p>Which produces the matrix <span class="math inline">\(\mathbf{P}_{PP}\)</span> a square <span class="math inline">\(M \times M\)</span> matrix containing the <em>degree-normalized similarities</em> between each pair of people.</p>
<p>We then do the same for groups:</p>
<p><span class="math display">\[
\mathbf{P}_{GG} = \mathbf{P}_G\mathbf{P}_P
\]</span></p>
<p>Which produces the matrix <span class="math inline">\(\mathbf{P}_{GG}\)</span> a square <span class="math inline">\(N \times N\)</span> matrix containing the <em>degree-normalized similarities</em> between each pair of groups.</p>
<p>In <code>R</code> we obtain these matrices as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>   P.pp <span class="ot">&lt;-</span> P.p <span class="sc">%*%</span> P.g</span>
<span id="cb16-2"><a href="#cb16-2"></a>   P.gg <span class="ot">&lt;-</span> P.g <span class="sc">%*%</span> P.p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Which are still row stochastic–but now square–matrices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>   <span class="fu">rowSums</span>(P.pp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   EVELYN     LAURA   THERESA    BRENDA CHARLOTTE   FRANCES   ELEANOR     PEARL 
        1         1         1         1         1         1         1         1 
     RUTH     VERNE     MYRNA KATHERINE    SYLVIA      NORA     HELEN   DOROTHY 
        1         1         1         1         1         1         1         1 
   OLIVIA     FLORA 
        1         1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>   <span class="fu">rowSums</span>(P.gg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 6/27   3/2  4/12  9/26  2/25  5/19  3/15  9/16   4/8  6/10  2/23   4/7 11/21 
    1     1     1     1     1     1     1     1     1     1     1     1     1 
  8/3 
    1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>   <span class="fu">dim</span>(P.pp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18 18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>   <span class="fu">dim</span>(P.gg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14 14</code></pre>
</div>
</div>
<p>Let’s peek inside one of these matrices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>   <span class="fu">round</span>(<span class="fu">head</span>(P.pp), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          EVELYN LAURA THERESA BRENDA CHARLOTTE FRANCES ELEANOR PEARL  RUTH
EVELYN     0.186 0.144   0.144  0.134     0.068   0.061   0.040 0.035 0.035
LAURA      0.165 0.179   0.132  0.132     0.056   0.070   0.060 0.028 0.042
THERESA    0.144 0.115   0.157  0.105     0.080   0.061   0.053 0.035 0.047
BRENDA     0.153 0.132   0.120  0.167     0.092   0.070   0.060 0.028 0.042
CHARLOTTE  0.135 0.098   0.160  0.160     0.160   0.073   0.056 0.000 0.056
FRANCES    0.122 0.122   0.122  0.122     0.073   0.122   0.080 0.049 0.049
          VERNE MYRNA KATHERINE SYLVIA  NORA HELEN DOROTHY OLIVIA FLORA
EVELYN    0.019 0.019     0.019  0.019 0.026 0.009   0.019   0.01  0.01
LAURA     0.024 0.010     0.010  0.024 0.032 0.024   0.010   0.00  0.00
THERESA   0.032 0.019     0.019  0.032 0.039 0.021   0.019   0.01  0.01
BRENDA    0.024 0.010     0.010  0.024 0.032 0.024   0.010   0.00  0.00
CHARLOTTE 0.025 0.000     0.000  0.025 0.025 0.025   0.000   0.00  0.00
FRANCES   0.018 0.018     0.018  0.018 0.031 0.018   0.018   0.00  0.00</code></pre>
</div>
</div>
<p>What are these numbers? Well, they can be interpreted as <em>probabilities</em> that a random walker starting at the row node and, following any sequence of <span class="math inline">\(person-group-person'-group'\)</span> hops, will reach the column person. Thus, higher values indicate an <em>affinity</em> or <em>proximity</em> between the people (and the groups in the corresponding matrix).</p>
</section>
<section id="performing-ca" class="level2">
<h2 class="anchored" data-anchor-id="performing-ca">Performing CA</h2>
<p>We went through all these steps because CA is equivalent to the eigendecomposition of the two last square matrices we obtained, namely, <span class="math inline">\(\mathbf{P_{PP}}\)</span> and <span class="math inline">\(\mathbf{P_{GG}}\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>   CA.p <span class="ot">&lt;-</span> <span class="fu">eigen</span>(P.pp)</span>
<span id="cb27-2"><a href="#cb27-2"></a>   CA.g <span class="ot">&lt;-</span> <span class="fu">eigen</span>(P.gg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see what we have here:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>   <span class="fu">round</span>(CA.p<span class="sc">$</span>values, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.00 0.63 0.32 0.18 0.14 0.11 0.10 0.06 0.04 0.04 0.02 0.01 0.01 0.00 0.00
[16] 0.00 0.00 0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>   <span class="fu">round</span>(CA.g<span class="sc">$</span>values, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.00 0.63 0.32 0.18 0.14 0.11 0.10 0.06 0.04 0.04 0.02 0.01 0.01 0.00</code></pre>
</div>
</div>
<p>So the two matrices have identical eigenvalues, and the first one is 1.0. Let’s check out the first three eigenvectors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>   <span class="fu">rownames</span>(CA.p<span class="sc">$</span>vectors) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(A)</span>
<span id="cb32-2"><a href="#cb32-2"></a>   <span class="fu">rownames</span>(CA.g<span class="sc">$</span>vectors) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(A)</span>
<span id="cb32-3"><a href="#cb32-3"></a>   <span class="fu">round</span>(CA.p<span class="sc">$</span>vectors[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]  [,2]  [,3]
EVELYN    -0.24 -0.24  0.03
LAURA     -0.24 -0.25 -0.01
THERESA   -0.24 -0.20  0.02
BRENDA    -0.24 -0.26 -0.01
CHARLOTTE -0.24 -0.29 -0.01
FRANCES   -0.24 -0.24 -0.02
ELEANOR   -0.24 -0.15 -0.03
PEARL     -0.24 -0.01  0.06
RUTH      -0.24 -0.05  0.03
VERNE     -0.24  0.13 -0.04
MYRNA     -0.24  0.25 -0.10
KATHERINE -0.24  0.31 -0.22
SYLVIA    -0.24  0.26 -0.20
NORA      -0.24  0.26 -0.03
HELEN     -0.24  0.24  0.07
DOROTHY   -0.24  0.09  0.09
OLIVIA    -0.24  0.33  0.66
FLORA     -0.24  0.33  0.66</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>   <span class="fu">round</span>(CA.g<span class="sc">$</span>vectors[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]  [,3]
6/27  0.27 -0.30 -0.01
3/2   0.27 -0.28 -0.04
4/12  0.27 -0.30  0.00
9/26  0.27 -0.30 -0.02
2/25  0.27 -0.25  0.00
5/19  0.27 -0.16  0.00
3/15  0.27 -0.04  0.05
9/16  0.27 -0.01  0.05
4/8   0.27  0.15 -0.19
6/10  0.27  0.32  0.22
2/23  0.27  0.35 -0.79
4/7   0.27  0.29  0.20
11/21 0.27  0.34  0.35
8/3   0.27  0.34  0.35</code></pre>
</div>
</div>
<p>So this is interesting. The first eigenvector of the decomposition of both <span class="math inline">\(\mathbf{P_{PP}}\)</span> and <span class="math inline">\(\mathbf{P_{GG}}\)</span> is just the same number for each person and group. Note that this is the eigenvector that is associated with the first eigenvalue which happens to be <span class="math inline">\(\lambda_1 = 1.0\)</span>.</p>
<p>So it looks like the first eigenvector is a pretty useless quantity (a constant) so we can discard it, keeping all the other ones. Now the old second eigenvector is the first, the old third is the second, and so on:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>   eig.vec.p <span class="ot">&lt;-</span> CA.p<span class="sc">$</span>vectors[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(CA.p<span class="sc">$</span>vectors)]</span>
<span id="cb36-2"><a href="#cb36-2"></a>   eig.vec.g <span class="ot">&lt;-</span> CA.g<span class="sc">$</span>vectors[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(CA.g<span class="sc">$</span>vectors)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the rest of the eigenvalues (discarding the 1.0 one) are arranged in descending order:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>   eig.vals <span class="ot">&lt;-</span> CA.p<span class="sc">$</span>values[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(CA.p<span class="sc">$</span>values)]</span>
<span id="cb37-2"><a href="#cb37-2"></a>   <span class="fu">round</span>(eig.vals, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.627 0.319 0.179 0.138 0.107 0.099 0.064 0.044 0.036 0.021 0.012 0.005
[13] 0.000 0.000 0.000 0.000 0.000</code></pre>
</div>
</div>
<p>The magnitude of the eigenvalue tells us how important is the related eigenvector in containing information about the original matrix. It looks like here, the first two eigenvectors contain a good chunk of the info.</p>
<p>We can check how much exactly by computing the ratio between the sum of the first two eigenvalues over the sum of all the eigenvalues:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>   <span class="fu">round</span>(<span class="fu">sum</span>(eig.vals[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])<span class="sc">/</span><span class="fu">sum</span>(eig.vals), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.57</code></pre>
</div>
</div>
<p>Which tells us that the first two eigenvectors account for about 57% of the action (or more precisely we could reconstruct the original matrix with 57% accuracy using just these two eigenvectors and associated eigenvalues).</p>
<p>Because the magnitude of the CA eigenvectors don’t have a natural scale, it is common to normalize them to have a variance of 1.0 <span class="citation" data-cites="fouss_etal16">(<a href="#ref-fouss_etal16" role="doc-biblioref">Fouss, Saerens, and Shimbo 2016, 399</a>)</span>, and the multiplying them by the square root of the eigenvalue corresponding to that dimension, so that the new variance is scaled to the importance of that dimension.</p>
<p>We can perform the no using the following function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>   norm.CA.vec <span class="ot">&lt;-</span> <span class="cf">function</span>(ev.p, ev.g, ev, x) {</span>
<span id="cb41-2"><a href="#cb41-2"></a>      N <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)</span>
<span id="cb41-3"><a href="#cb41-3"></a>      D.p <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">rowSums</span>(x))</span>
<span id="cb41-4"><a href="#cb41-4"></a>      D.g <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">colSums</span>(x))</span>
<span id="cb41-5"><a href="#cb41-5"></a>      Z.uni.p <span class="ot">&lt;-</span> ev.p</span>
<span id="cb41-6"><a href="#cb41-6"></a>      Z.uni.g <span class="ot">&lt;-</span> ev.g</span>
<span id="cb41-7"><a href="#cb41-7"></a>      Z.val.p <span class="ot">&lt;-</span> ev.p</span>
<span id="cb41-8"><a href="#cb41-8"></a>      Z.val.g <span class="ot">&lt;-</span> ev.g</span>
<span id="cb41-9"><a href="#cb41-9"></a>      ev <span class="ot">&lt;-</span> ev[<span class="fu">which</span>(ev <span class="sc">&gt;</span> <span class="fl">0.001</span>)]</span>
<span id="cb41-10"><a href="#cb41-10"></a>      m <span class="ot">&lt;-</span> <span class="fu">length</span>(ev)</span>
<span id="cb41-11"><a href="#cb41-11"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb41-12"><a href="#cb41-12"></a>         norm <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">t</span>(ev.p[, i]) <span class="sc">%*%</span> D.p <span class="sc">%*%</span> ev.p[, i])</span>
<span id="cb41-13"><a href="#cb41-13"></a>         Z.uni.p[, i] <span class="ot">&lt;-</span> ev.p[, i] <span class="sc">*</span> <span class="fu">sqrt</span>(N<span class="sc">/</span>norm) <span class="co">#normalizing to unit variance</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>         Z.val.p[, i] <span class="ot">&lt;-</span> Z.uni.p[, i] <span class="sc">*</span> <span class="fu">sqrt</span>(ev[i]) <span class="co">#normalizing to square root of eigenvalue</span></span>
<span id="cb41-15"><a href="#cb41-15"></a>         norm <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">t</span>(ev.g[, i]) <span class="sc">%*%</span> D.g <span class="sc">%*%</span> ev.g[, i])</span>
<span id="cb41-16"><a href="#cb41-16"></a>         Z.uni.g[, i] <span class="ot">&lt;-</span> ev.g[, i] <span class="sc">*</span> <span class="fu">sqrt</span>(N<span class="sc">/</span>norm) <span class="co">#normalizing to unit variance</span></span>
<span id="cb41-17"><a href="#cb41-17"></a>         Z.val.g[, i] <span class="ot">&lt;-</span> Z.uni.g[, i] <span class="sc">*</span> <span class="fu">sqrt</span>(ev[i]) <span class="co">#normalizing to square root of eigenvalue</span></span>
<span id="cb41-18"><a href="#cb41-18"></a>      }</span>
<span id="cb41-19"><a href="#cb41-19"></a>   <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Z.uni.p =</span> Z.uni.p, <span class="at">Z.uni.g =</span> Z.uni.g,</span>
<span id="cb41-20"><a href="#cb41-20"></a>               <span class="at">Z.val.p =</span> Z.val.p, <span class="at">Z.val.g =</span> Z.val.g))</span>
<span id="cb41-21"><a href="#cb41-21"></a>   }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see this it at work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>   norm.CA.res <span class="ot">&lt;-</span> <span class="fu">norm.CA.vec</span>(<span class="at">ev.p =</span> eig.vec.p,</span>
<span id="cb42-2"><a href="#cb42-2"></a>                              <span class="at">ev.g =</span> eig.vec.g,</span>
<span id="cb42-3"><a href="#cb42-3"></a>                              <span class="at">ev =</span> eig.vals,</span>
<span id="cb42-4"><a href="#cb42-4"></a>                              <span class="at">x =</span> A)</span>
<span id="cb42-5"><a href="#cb42-5"></a>   uni.p <span class="ot">&lt;-</span> norm.CA.res<span class="sc">$</span>Z.uni.p[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb42-6"><a href="#cb42-6"></a>   uni.g <span class="ot">&lt;-</span> norm.CA.res<span class="sc">$</span>Z.uni.g[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb42-7"><a href="#cb42-7"></a>   val.p <span class="ot">&lt;-</span> norm.CA.res<span class="sc">$</span>Z.val.p[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb42-8"><a href="#cb42-8"></a>   val.g <span class="ot">&lt;-</span> norm.CA.res<span class="sc">$</span>Z.val.g[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb42-9"><a href="#cb42-9"></a>   val.p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 [,1]        [,2]
EVELYN    -0.79943960  0.11278306
LAURA     -0.84268875 -0.03973055
THERESA   -0.65385049  0.08107422
BRENDA    -0.85525924 -0.05084420
CHARLOTTE -0.97355171 -0.03683948
FRANCES   -0.79735973 -0.05794469
ELEANOR   -0.51100542 -0.11667376
PEARL     -0.03886019  0.21166654
RUTH      -0.16808778  0.09675346
VERNE      0.43365671 -0.13043066
MYRNA      0.82692882 -0.32634275
KATHERINE  1.04548381 -0.75320115
SYLVIA     0.87293948 -0.67852654
NORA       0.87170608 -0.10704728
HELEN      0.80785397  0.24658073
DOROTHY    0.30305102  0.31098283
OLIVIA     1.09592846  2.25111963
FLORA      1.09592846  2.25111963</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>   val.g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]         [,2]
6/27  -1.05105209 -0.013102803
3/2   -0.96628708 -0.090934069
4/12  -1.03576945 -0.002506996
9/26  -1.03598031 -0.046981456
2/25  -0.88400343  0.002527085
5/19  -0.57238475 -0.007363883
3/15  -0.12856709  0.130215074
9/16  -0.03396682  0.138293265
4/8    0.51401652 -0.489688997
6/10   1.11736277  0.572957680
2/23   1.22199521 -2.053968597
4/7    1.02239016  0.515941481
11/21  1.17425558  0.907870234
8/3    1.17425558  0.907870234</code></pre>
</div>
</div>
<p>Great! Now we have two sets (unit variance versus eigenvalue variance) of normalized CA scores for persons and groups on the first two dimensions.</p>
</section>
<section id="the-duality-of-ca-scores-between-persons-and-groups" class="level2">
<h2 class="anchored" data-anchor-id="the-duality-of-ca-scores-between-persons-and-groups">The Duality of CA Scores Between Persons and Groups</h2>
<p>Just like with the eigenvector centrality there is a <em>duality</em> between the CA scores assigned to the person and the groups on each dimension, such that the scores for each person are a weighted sum of the sum of the scores assigned to each group on that dimension and vice versa <span class="citation" data-cites="faust97">(<a href="#ref-faust97" role="doc-biblioref">Faust 1997, 171</a>)</span>.</p>
<p>The main difference is that this time we sum scores across the <span class="math inline">\(\mathbf{P_P}\)</span> and <span class="math inline">\(\mathbf{P_G}\)</span> matrices rather than the original affiliation matrix and its transpose, resulting in <em>degree-weighted</em> sums of scores for both persons and groups.</p>
<p>So for any given person, on any given dimension, let’s say <span class="math inline">\(EVELYN\)</span>, her CA score is given by the sum of the (unit variance normalized) CA scores of the groups she belongs to weighted by her degree (done by multiplying each CA score by the relevant cell in Evelyn’s row of the <span class="math inline">\(\mathbf{P_P}\)</span> matrix):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>   <span class="fu">sum</span>(P.p[<span class="st">"EVELYN"</span>, ] <span class="sc">*</span> uni.g[, <span class="dv">1</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.7994396</code></pre>
</div>
</div>
<p>Which is the same as the (eigenvalue variance) normalized score we obtained via CA for <span class="math inline">\(EVELYN\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>   val.p[<span class="st">"EVELYN"</span>, <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    EVELYN 
-0.7994396 </code></pre>
</div>
</div>
<p>A similar story applies to groups. Each group score is the group-size-weighted sum of the (unit variance normalized) CA scores of the people who join it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>   <span class="fu">sum</span>(P.g[<span class="st">"6/27"</span>, ] <span class="sc">*</span> uni.p[, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.051052</code></pre>
</div>
</div>
<p>Which is the same as the (eigenvalue variance normalized) score we obtained via CA:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>    val.g[<span class="st">"6/27"</span>, <span class="dv">1</span>]  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     6/27 
-1.051052 </code></pre>
</div>
</div>
<p>Neat! Duality at work.</p>
</section>
<section id="visualizing-two-mode-networks-using-ca" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-two-mode-networks-using-ca">Visualizing Two-Mode Networks Using CA</h2>
<p>And, finally, we can use the first two (eigenvalue variance) normalized eigenvectors to plot the persons and groups in a common two-dimensional space:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>   val.g[, <span class="dv">2</span>] <span class="ot">&lt;-</span> val.g[, <span class="dv">2</span>]<span class="sc">*-</span><span class="dv">1</span> <span class="co">#flippling sign of group scores on second dimension for plotting purposes</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>   plot.dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rbind</span>(val.p, val.g)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3"></a>      <span class="fu">cbind</span>(<span class="at">type =</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">18</span>), <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">14</span>))))</span>
<span id="cb54-4"><a href="#cb54-4"></a>   <span class="fu">library</span>(ggplot2)</span>
<span id="cb54-5"><a href="#cb54-5"></a>   <span class="co"># install.packages("ggrepel")</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>   <span class="fu">library</span>(ggrepel)</span>
<span id="cb54-7"><a href="#cb54-7"></a>   p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> plot.dat, <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">color =</span> type))</span>
<span id="cb54-8"><a href="#cb54-8"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"gray"</span>)</span>
<span id="cb54-9"><a href="#cb54-9"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"gray"</span>)</span>
<span id="cb54-10"><a href="#cb54-10"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">rownames</span>(plot.dat)), </span>
<span id="cb54-11"><a href="#cb54-11"></a>                            <span class="at">max.overlaps =</span> <span class="dv">20</span>, <span class="at">size =</span> <span class="fl">2.75</span>)</span>
<span id="cb54-12"><a href="#cb54-12"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb54-13"><a href="#cb54-13"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb54-14"><a href="#cb54-14"></a>                  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb54-15"><a href="#cb54-15"></a>                  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb54-16"><a href="#cb54-16"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>))</span>
<span id="cb54-17"><a href="#cb54-17"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"First Dimension"</span>, <span class="at">y =</span> <span class="st">"Second Dimension"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb54-18"><a href="#cb54-18"></a>   p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ca_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this space, people with the most similar patterns of memberships to the most similar groups are placed close to one another. In the same way, groups with the most similar members are placed closed to one another.</p>
<p>Also like before, we can use the scores obtained from the CA analysis to re-arrange the rows and columns of the original matrix to reveal blocks of maximally similar persons and events:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>   <span class="fu">library</span>(ggcorrplot)</span>
<span id="cb55-2"><a href="#cb55-2"></a>   p <span class="ot">&lt;-</span> <span class="fu">ggcorrplot</span>(<span class="fu">t</span>(A[<span class="fu">order</span>(eig.vec.p[,<span class="dv">1</span>]), <span class="fu">order</span>(eig.vec.g[,<span class="dv">1</span>])]), </span>
<span id="cb55-3"><a href="#cb55-3"></a>                   <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>)) </span>
<span id="cb55-4"><a href="#cb55-4"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb55-5"><a href="#cb55-5"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb55-6"><a href="#cb55-6"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb55-7"><a href="#cb55-7"></a>                  )</span>
<span id="cb55-8"><a href="#cb55-8"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">"top"</span>) </span>
<span id="cb55-9"><a href="#cb55-9"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">6.5</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb55-10"><a href="#cb55-10"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">10.5</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb55-11"><a href="#cb55-11"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">9.5</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb55-12"><a href="#cb55-12"></a>   p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">6.5</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb55-13"><a href="#cb55-13"></a>   p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ca_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here CA seems to have detected two separate clusters of actors who preferentially attend two distinct clusters of events!</p>
<p>The three events in the middle <span class="math inline">\(\{3/15, 9/16, 4/8\}\)</span> don’t seem to differentiate between participants in each cluster (everyone attends)–they thus appear near the origin in the CA diagram, indicating a weak association with either dimension.</p>
<p>However, the events to the left (with clusters of participants in the lower-left) and to the right of the x-axis (with clusters of participants in the upper-right) are attended preferentially by distinct groups of participants; they thus appear at the extreme left and right positions of the first dimension of the CA diagram.</p>
<p>In the same way, the four people in the middle <span class="math inline">\(\{Ruth, Dorothy, Pearl, Verne\}\)</span> only attend the undifferentiated, popular events, so that means that they are not strongly associated with either cluster of actors (and thus appear near the origin in the CA diagram). The top and bottom participants, by contrast, appear to the extreme right and left in the CA diagram, indicating a strong association with the underlying dimensions.</p>
<p>Note the similarity between this blocking and that obtained from the structural equivalence analysis in the previous handout.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-faust97" class="csl-entry" role="doc-biblioentry">
Faust, Katherine. 1997. <span>“Centrality in Affiliation Networks.”</span> <em>Social Networks</em> 19 (2): 157–91.
</div>
<div id="ref-fouss_etal16" class="csl-entry" role="doc-biblioentry">
Fouss, François, Marco Saerens, and Masashi Shimbo. 2016. <em>Algorithms and Models for Network Data and Link Analysis</em>. Cambridge University Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>